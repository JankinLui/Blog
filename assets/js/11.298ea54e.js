(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{485:function(s,a,t){s.exports=t.p+"assets/img/2.3.b499fda7.png"},486:function(s,a,t){s.exports=t.p+"assets/img/problem1.6b4f7914.png"},487:function(s,a,t){s.exports=t.p+"assets/img/problem2.22d39e1e.png"},488:function(s,a,t){s.exports=t.p+"assets/img/problem3.3fca2e6e.png"},489:function(s,a,t){s.exports=t.p+"assets/img/problem4.38cd9e42.png"},490:function(s,a,t){s.exports=t.p+"assets/img/problem5.13b37247.png"},491:function(s,a,t){s.exports=t.p+"assets/img/problem6.e8b51999.png"},492:function(s,a,t){s.exports=t.p+"assets/img/problem7.f698cb87.png"},493:function(s,a,t){s.exports=t.p+"assets/img/problem8.8956af4a.png"},494:function(s,a,t){s.exports=t.p+"assets/img/problem9.247629a8.png"},569:function(s,a,t){"use strict";t.r(a);var n=t(2),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"第1章-rsync-软件介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第1章-rsync-软件介绍"}},[s._v("#")]),s._v(" "),a("strong",[s._v("第")]),s._v("1章 "),a("strong",[s._v("rsync")]),s._v(" "),a("strong",[s._v("软件介绍")])]),s._v(" "),a("h3",{attrs:{id:"_1-1-什么是rsync"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-什么是rsync"}},[s._v("#")]),s._v(" "),a("strong",[s._v("1.1")]),s._v(" 什么是rsync")]),s._v(" "),a("p",[s._v("rsync 是一款开源的、快速的、多功能的、可实现全量及增量的本地或远程数据同步备份的优秀工具。")]),s._v(" "),a("p",[a("a",{attrs:{href:"http://www.samba.org/ftp/rsync/rsync.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("英文手册阅读"),a("OutboundLink")],1)]),s._v(" "),a("h4",{attrs:{id:"_1-1-1-全量及增量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-1-全量及增量"}},[s._v("#")]),s._v(" "),a("strong",[s._v("1.1.1")]),s._v(" 全量及增量")]),s._v(" "),a("p",[s._v("全量：将全部数据，进行传输覆盖")]),s._v(" "),a("p",[s._v("增量：只传输差异部分的数据")]),s._v(" "),a("h3",{attrs:{id:"_1-2-实现增量复制的原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-实现增量复制的原理"}},[s._v("#")]),s._v(" "),a("strong",[s._v("1.2")]),s._v(" 实现增量复制的原理")]),s._v(" "),a("p",[s._v("Rsync通过其独特的“quick check”算法，实现增量传输数据")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup ~]#man rsync\nRsync  finds  files  that  need  to  be transferred using a “quick check” algorithm (by default)  that  looks  for  files  that  have changed  in  size  or  in  last-modified time.  Any changes in the other preserved attributes (as requested by options) are  made  on the  destination file directly when the quick check indicates that the file’s data does not need to be updated.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("在同步备份数据时，默认情况下，Rsync通过其独特的“quick check”算法，它仅同步大小或者最后修改时间发生变化的文件或目录，当然也可根据权限，属主等属性的变化同步，但需要指定相应的参数，甚至可以实现只同步一个文件里有变化的内容部分，所以，可以实现快速的同步备份数据。")]),s._v(" "),a("blockquote",[a("p",[s._v("ps")]),s._v(" "),a("p",[a("em",[s._v("centos 5 rsync 2.x")]),s._v(" "),a("em",[s._v("先比对再同步，速度较慢")])]),s._v(" "),a("p",[a("em",[s._v("centos 6 rsync 3.x")]),s._v(" "),a("em",[s._v("一边比对，一边对差异部分进行同步")])])]),s._v(" "),a("h4",{attrs:{id:"_1-2-1-软件版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-软件版本"}},[s._v("#")]),s._v(" "),a("strong",[s._v("1.2.1")]),s._v(" 软件版本")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup ~]# rsync --version\nrsync  version 3.0.6  protocol version 30\nCopyright (C) 1996-2009 by Andrew Tridgell, Wayne Davison, and others.\nWeb site: http://rsync.samba.org/\nCapabilities:\n    64-bit files, 64-bit inums, 64-bit timestamps, 64-bit long ints,\n    socketpairs, hardlinks, symlinks, IPv6, batchfiles, inplace,\n    append, ACLs, xattrs, iconv, symtimes\nrsync comes with ABSOLUTELY NO WARRANTY.  This is free software, and you\nare welcome to redistribute it under certain conditions.  See the GNU\nGeneral Public Licence for details.\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h3",{attrs:{id:"_1-3-rsync-软件功能介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-rsync-软件功能介绍"}},[s._v("#")]),s._v(" 1.3 rsync 软件功能介绍")]),s._v(" "),a("ul",[a("li",[a("p",[a("em",[s._v("类似于 cp 命令 -- 实现本地备份传输数据")])])]),s._v(" "),a("li",[a("p",[a("em",[s._v("类似于scp 命令 -- 远程备份传输数据")])])]),s._v(" "),a("li",[a("p",[a("em",[s._v("类似于 rm 命令 -- 实现无差异同步备份")])])]),s._v(" "),a("li",[a("p",[a("em",[s._v("类似于")]),s._v(" "),a("em",[s._v("ls")]),s._v(" "),a("em",[s._v("命令")]),s._v(" "),a("em",[s._v("--")]),s._v(" "),a("em",[s._v("本地文件信息查看")])])])]),s._v(" "),a("blockquote",[a("p",[s._v("ps")]),s._v(" "),a("p",[s._v("rsync 命令属于1v4 的命令")])]),s._v(" "),a("h4",{attrs:{id:"_1-3-1-rsync-cp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-1-rsync-cp"}},[s._v("#")]),s._v(" 1.3.1 rsync == cp")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup ~]# cp -a  /etc/hosts /tmp/\n[root@backup ~]# ls /tmp/\nhosts\n[root@backup ~]# \\rm /tmp/hosts\n[root@backup ~]# rsync  /etc/hosts /tmp/\n[root@backup ~]# ls /tmp/hosts\n/tmp/hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h4",{attrs:{id:"_1-3-2-rsync-scp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-2-rsync-scp"}},[s._v("#")]),s._v(" 1.3.2 rsync == scp")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("使用scp实现")]),s._v(" "),a("p",[s._v("检查对端服务器目标位置上是否有该文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 ~]# ls /tmp/hosts\nls: cannot access /tmp/hosts: No such file or directory\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("从本地拷贝到远端服务器上")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup ~]# ls /tmp/hosts\n/tmp/hosts\n[root@backup ~]# scp -rp /etc/hosts 10.0.0.31:/tmp/\nThe authenticity of host '10.0.0.31 (10.0.0.31)' can't be established.\nRSA key fingerprint is d3:41:bb:0d:43:88:da:a3:2c:e8:36:91:11:c9:e4:9c.\nAre you sure you want to continue connecting (yes/no)? yes\nWarning: Permanently added '10.0.0.31' (RSA) to the list of known hosts.\nroot@10.0.0.31's password:\nhosts                                           100%  357     0.4KB/s   00:00\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("检查远端服务器上的结果")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 ~]# ls /tmp/hosts\n/tmp/hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("使用rsync 实现")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup ~]# rsync -rp /etc/hosts 10.0.0.31:/tmp/\nroot@10.0.0.31's password:\n[root@backup ~]#\n[root@nfs01 ~]# ls /tmp/hosts\n/tmp/hosts\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])])]),s._v(" "),a("h4",{attrs:{id:"_1-3-3-rsync-rm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-3-rsync-rm"}},[s._v("#")]),s._v(" 1.3.3 rsync == rm")]),s._v(" "),a("h5",{attrs:{id:"_1-3-3-1-环境准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-3-1-环境准备"}},[s._v("#")]),s._v(" 1.3.3.1 环境准备")]),s._v(" "),a("p",[s._v("创建出来一次命令 进行操作")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup tmp]# mkdir /znix\n[root@backup znix]# cp /tmp/* .\n[root@backup znix]# ll\ntotal 4\n-rw-r--r-- 1 root root 357 Oct 11 15:21 hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("rm命令操作")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup znix]# rm -rf /znix/hosts\n[root@backup znix]# ll /znix/hosts\nls: cannot access /znix/hosts: No such file or directory\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("查看这文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup ~]# l\ntotal 4\n-rw-r--r-- 1 root root 357 Oct 11 15:21 hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("创建一个空目录，使用空目录进行无差异同步")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup ~]# mkdir /null\n[root@backup ~]# rsync --delete  /null/ /znix/\nrsync: --delete does not work without -r or -d.\nrsync error: syntax or usage error (code 1) at main.c(1422) [client=3.0.6]\n[root@backup ~]# rsync  -a  --delete  /null/ /znix/\n[root@backup ~]# ll /znix/\ntotal 0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h4",{attrs:{id:"_1-3-4-rsync-ls-l"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-4-rsync-ls-l"}},[s._v("#")]),s._v(" 1.3.4 rsync == ls -l")]),s._v(" "),a("p",[s._v("使用rsync 可以实现与 ls 类似的功能")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup ~]# ls -l install.log\n-rw-r--r--. 1 root root 21736 Sep 25 08:38 install.log\n[root@backup ~]# rsync install.log\n-rw-r--r--       21736 2017/09/25 08:38:28 install.log\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"_1-4-rsync的特性总结-7个特性信息说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-rsync的特性总结-7个特性信息说明"}},[s._v("#")]),s._v(" 1.4 Rsync的特性总结（7个特性信息说明）")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("支持拷贝普通文件与特殊文件如链接文件，设备等。")])]),s._v(" "),a("li",[a("p",[s._v("可以有排除指定文件或目录同步的功能，相当于打包命令tar的排除功能。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("tar zcvf backup_1.tar.gz /opt/data -exclude=clsn  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v("说明：")]),s._v(" "),a("p",[s._v("在打包/opt/data时就排除了clsn命名的目录和文件。")])])]),s._v(" "),a("li",[a("p",[s._v("可以做到保持原文件或目录的权限、时间、软硬链接、属主、组等所有属性均不改变-p。")])]),s._v(" "),a("li",[a("p",[s._v("可实现增量同步，既只同步发生变化的数据，因此数据传输效率很高（tar -N）。\n将备份/home 目录自 2008-01-29 以来修改过的文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("tar -N 2008-01-29 -zcvf /backups/inc-backup_$(date +%F).tar.gz /home\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("将备份 /home 目录昨天以来修改过的文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(' tar -N $(date -d yesterday "+%F") -zcvf /backups/inc-backup_$(date +%F).tar.gz /home\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("添加文件到已经打包的文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("tar -rf all.tar *.gif\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v("说明：")]),s._v(" "),a("p",[s._v("这条命令是将所有.gif的文件增加到all.tar的包里面去。-r是表示增加文件的意思。")])])]),s._v(" "),a("li",[a("p",[s._v("可以使用rcp,rsh,ssh等方式来配合进行隧道加密传输文件（rsync本身不对数据加密）")])]),s._v(" "),a("li",[a("p",[s._v("可以通过socket(进程方式)传输文件和数据（服务端和客户端）* * * * *。重点掌握")])]),s._v(" "),a("li",[a("p",[s._v("支持匿名的或认证（无需系统用户）的进程模式传输，可实现方便安全的进行数据备份及镜像。")])])]),s._v(" "),a("h3",{attrs:{id:"_1-5-rsync的企业工作场景说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-rsync的企业工作场景说明"}},[s._v("#")]),s._v(" 1.5 Rsync的企业工作场景说明")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("两台服务器之间数据同步（定时任务cron+rsync)")]),s._v(" "),a("p",[s._v("同步网站内部人员数据信息（定时任务最小周期为1分钟）")])]),s._v(" "),a("li",[a("p",[s._v("两台服务器之间数据同步（实时任务inotify/sersync/lrsyncd+rsync）同步网站用户人员数据信息")])])]),s._v(" "),a("h2",{attrs:{id:"第2章-rsync使用方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第2章-rsync使用方式"}},[s._v("#")]),s._v(" 第2章 rsync使用方式")]),s._v(" "),a("h3",{attrs:{id:"_2-1-rsync软件工作方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-rsync软件工作方式"}},[s._v("#")]),s._v(" 2.1 rsync软件工作方式")]),s._v(" "),a("p",[s._v("SYNOPSIS")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("本地数据同步方式\nLocal:  rsync [OPTION...] SRC... [DEST]\n远程数据同步方式\nAccess via remote shell:\nPull: rsync [OPTION...] [USER@]HOST:SRC... [DEST]\nPush: rsync [OPTION...] SRC... [USER@]HOST:DEST\n守护进程方式同步数据\nAccess via rsync daemon:\nPull: rsync [OPTION...] [USER@]HOST::SRC... [DEST]\n      rsync [OPTION...] rsync://[USER@]HOST[:PORT]/SRC... [DEST]\nPush: rsync [OPTION...] SRC... [USER@]HOST::DEST\n      rsync [OPTION...] SRC... rsync://[USER@]HOST[:PORT]/DEST\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h4",{attrs:{id:"_2-1-1-本地数据同步方式-类似于cp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-本地数据同步方式-类似于cp"}},[s._v("#")]),s._v(" 2.1.1 本地数据同步方式（类似于cp）")]),s._v(" "),a("p",[s._v("Local: rsync [OPTION...] SRC... [DEST]")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("参数")]),s._v(" "),a("th",[s._v("含义")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("rsync")]),s._v(" "),a("td",[s._v("数据同步命令")])]),s._v(" "),a("tr",[a("td",[s._v("[OPTION...]")]),s._v(" "),a("td",[s._v("rsync命令参数信息")])]),s._v(" "),a("tr",[a("td",[s._v("SRC")]),s._v(" "),a("td",[s._v("要同不得数据信息（文件或目录）")])]),s._v(" "),a("tr",[a("td",[s._v("[DEST]")]),s._v(" "),a("td",[s._v("将数据传输到什么位置")])])])]),s._v(" "),a("h5",{attrs:{id:"_2-1-1-1-实例演示命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-1-实例演示命令"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2.1.1.1")]),s._v(" 实例演示命令：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup ~]# rsync  /etc/hosts /tmp/\n[root@backup ~]# ls /tmp/hosts\n/tmp/hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"_2-1-2-远程数据同步方式-类似scp-又称为隧道传输"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-远程数据同步方式-类似scp-又称为隧道传输"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2.1.2")]),s._v(" 远程数据同步方式（类似scp）---又称为隧道传输")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Access via remote shell:\n  Pull: rsync [OPTION...] [USER@]HOST:SRC... [DEST]\n  Push: rsync [OPTION...] SRC... [USER@]HOST:DEST\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("blockquote",[a("p",[s._v("说明：")]),s._v(" "),a("p",[s._v("需要进行交互传输数据。如果想实现免交互传输数据，需要借助ssh+key方式实现")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[a("em",[a("strong",[s._v("pull：拉：")])])]),s._v(" "),a("th")])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("[USER@] ：")]),s._v(" "),a("td",[s._v("以什么用户身份传输数据信息")])]),s._v(" "),a("tr",[a("td",[s._v("HOST:")]),s._v(" "),a("td",[s._v("远程主机信息（IP地址信息 主机名称信息）")])]),s._v(" "),a("tr",[a("td",[s._v("SRC:")]),s._v(" "),a("td",[s._v("远端要恏过来的数据信息")])]),s._v(" "),a("tr",[a("td",[s._v("[dest]")]),s._v(" "),a("td",[s._v("恏到本地什么位置")])]),s._v(" "),a("tr",[a("td",[a("em",[a("strong",[s._v("push：推：")])])]),s._v(" "),a("td")]),s._v(" "),a("tr",[a("td",[s._v("SRC：")]),s._v(" "),a("td",[s._v("本地要怼过去的数据信息")])]),s._v(" "),a("tr",[a("td",[s._v("DEST")]),s._v(" "),a("td",[s._v("怼到远端什么位置")])])])]),s._v(" "),a("h4",{attrs:{id:"_2-1-3-【实践操作】pull拉"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-3-【实践操作】pull拉"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2.1.3")]),s._v(" 【实践操作】pull拉")]),s._v(" "),a("p",[s._v("从远端拉文件到当前目录")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 ~]# touch /tmp/1.txt\n[root@backup ~]# rsync nfs01:/tmp/1.txt .\nroot@nfs01's password:\n[root@backup ~]# ll\ntotal 44\n-rw-r--r--  1 root root     0 Oct 11 16:16 1.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h4",{attrs:{id:"_2-1-4-【实践操作】push推-目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-4-【实践操作】push推-目录"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2.1.4")]),s._v(" 【实践操作】push推（目录）")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("将本地的hosts文件推到远端服务器上")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup tmp]# ll\ntotal 4\n-rw-r--r-- 1 root root 357 Oct 11 15:12 hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("使用push的格式 推整个目录（包括目录）")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup tmp]# rsync -r /tmp nfs01:/tmp/\nroot@nfs01's password:\n[root@nfs01 tmp]# ll\ntotal 4\ndrwxr-xr-x 3 root root 4096 Oct 11 16:20 tmp\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("推整个目录下的文件（不包括目录本身）")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup tmp]# rsync -r /tmp/ nfs01:/tmp/\nroot@nfs01's password:\n[root@nfs01 tmp]# ll\ntotal 8\n-rw-r--r-- 1 root root  357 Oct 11 16:21 hosts\ndrwxr-xr-x 3 root root 4096 Oct 11 16:20 tmp\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("blockquote",[a("p",[s._v("说明：")]),s._v(" "),a("p",[a("em",[s._v("/tmp  --表示将tmp目录本身及目录下的内容进行传输")])]),s._v(" "),a("p",[a("em",[s._v("/tmp/ --表示只传输**tmp目录下面的内容信息")])])])])]),s._v(" "),a("h3",{attrs:{id:"_2-2-守护进程方式同步数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-守护进程方式同步数据"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2.2")]),s._v(" "),a("strong",[s._v("守护进程方式同步数据")])]),s._v(" "),a("p",[s._v("[root@localhost ~]# uname -a\nLinux 2.6.32-696.el6.x86_64 #1 SMP Tue Mar 21 19:29:05 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\nAccess via rsync daemon:\nPull: rsync [OPTION...] [USER@]HOST::SRC... [DEST]\nrsync [OPTION...] rsync://[USER@]HOST[:PORT]/SRC... [DEST]\nPush: rsync [OPTION...] SRC... [USER@]HOST::DEST\nrsync [OPTION...] SRC... rsync://[USER@]HOST[:PORT]/DEST")]),s._v(" "),a("h4",{attrs:{id:"_2-2-1-配置rsync守护进程方式-需要有服务端与客户端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-配置rsync守护进程方式-需要有服务端与客户端"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2.2.1")]),s._v(" "),a("strong",[s._v("配置")]),s._v("rsync守护进程方式（需要有服务端与客户端）")]),s._v(" "),a("p",[s._v("规划：")]),s._v(" "),a("p",[a("em",[s._v("1. backup服务器作为rsync服务端")])]),s._v(" "),a("p",[a("em",[s._v("2. 以rysnc客户端作为参照物，将数据推到rsync服务器上")])]),s._v(" "),a("h4",{attrs:{id:"_2-2-2-配置rsync服务端-将服务端配置到-backup-服务器上"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-配置rsync服务端-将服务端配置到-backup-服务器上"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2.2.2")]),s._v(" 配置rsync服务端（将服务端配置到 "),a("strong",[s._v("backup")]),s._v(" 服务器上）")]),s._v(" "),a("h5",{attrs:{id:"第一个里程碑-软件是否存在"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第一个里程碑-软件是否存在"}},[s._v("#")]),s._v(" 第一个里程碑： 软件是否存在")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup ~]# rpm -qa |grep rsync\nrsync-3.0.6-12.el6.x86_64\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h5",{attrs:{id:"第二个里程碑-进行软件服务配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第二个里程碑-进行软件服务配置"}},[s._v("#")]),s._v(" 第二个里程碑： 进行软件服务配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('[root@backup ~]# vim /etc/rsyncd.conf\nuid = rsync             //指定管理备份目录的用户\ngid = rsync             //指定管理备份目录的用户组\nport=873                //定义rsync备份服务的网络端口号\nfake super=yes          //伪装root用户(无需让rsync以root身份运行，允许存储文件的完整属性)\nuse chroot = no         //和安全相关的配置\nmax connections = 200   //最大连接数  同时自能有200个客户端连接到备份服务器\ntimeout = 300           //超时时间（单位秒）\npid file = /var/run/rsyncd.pid         //记录进程号码信息 1.让程序快速停止进程  2.判断一个服务是否正在运行\nlock file = /var/run/rsync.lock        //锁文件 保证文件到达限制后无法再进行连接\nlog file = /var/log/rsyncd.log         //rsync服务的日志文件  用于排除分析问题\nignore errors                          //忽略传输文件中的简单错误\nread only = false                //指定备份目录是可读可写\nlist = false                     //使客户端可以查看服务器的模块信息\nhosts allow = 172.16.1.0/24      //允许传输备份数据的主机（白名单）\nhosts deny = 0.0.0.0/32          //禁止传输备份数据的主机（黑名单）\nauth users = rsync_backup        //指定认证用户\nsecrets file = /etc/rsync.password     //指定认证用户密码文件  用户名称：密码信息\n[backup]                         //模块信息\ncomment = "backup dir by clsn"                                   \npath = /backup          //模块中备份参数  指定备份目录\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h5",{attrs:{id:"第三个里程-创建rsync用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第三个里程-创建rsync用户"}},[s._v("#")]),s._v(" 第三个里程：创建rsync用户")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup ~]# id rsync\nid: rsync: No such user\n[root@backup ~]# useradd -s /sbin/nologin -M rsync\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h5",{attrs:{id:"第四个里程碑-创建数据备份储存目录-目录修改属主"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第四个里程碑-创建数据备份储存目录-目录修改属主"}},[s._v("#")]),s._v(" 第四个里程碑： 创建数据备份储存目录,目录修改属主")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup ~]# mkdir /backup/\n[root@backup ~]# chown -R rsync.rsync /backup/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h5",{attrs:{id:"第五个里程碑-创建认证用户密码文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第五个里程碑-创建认证用户密码文件"}},[s._v("#")]),s._v(" 第五个里程碑： 创建认证用户密码文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('echo "rsync_backup:clsn123" >>/etc/rsync.password\nchmod 600 /etc/rsync.password\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h5",{attrs:{id:"第六个里程碑-启动rsync服"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第六个里程碑-启动rsync服"}},[s._v("#")]),s._v(" 第六个里程碑： 启动rsync服")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("rsync --daemon\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h5",{attrs:{id:"至此服务端配置完成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#至此服务端配置完成"}},[s._v("#")]),s._v(" 至此服务端配置完成")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup ~]# ps -ef |grep rsync\nroot       2076      1  0 17:05 ?        00:00:00 rsync --daemon\nroot       2163   1817  0 17:38 pts/1    00:00:00 grep --color=auto rsync\n[root@backup ~]# netstat -lntup |grep rsync\ntcp        0      0 0.0.0.0:873                 0.0.0.0:*                   LISTEN      2076/rsync         \ntcp        0      0 :::873                      :::*                        LISTEN      2076/rsync \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h4",{attrs:{id:"_2-2-3-配置rsync客户端-其他服务器为客户端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-配置rsync客户端-其他服务器为客户端"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2.2.3")]),s._v(" 配置rsync客户端（其他服务器为客户端）")]),s._v(" "),a("h5",{attrs:{id:"第一个里程碑-软件是否存在-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第一个里程碑-软件是否存在-2"}},[s._v("#")]),s._v(" 第一个里程碑： 软件是否存在")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 ~]# rpm -qa |grep rsync\nrsync-3.0.6-12.el6.x86_64\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h5",{attrs:{id:"第二个里程碑-创建认证文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第二个里程碑-创建认证文件"}},[s._v("#")]),s._v(" 第二个里程碑： 创建认证文件")]),s._v(" "),a("p",[s._v("客户端的认证文件只需要有密码即可")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('echo "clsn123" >>/etc/rsync.password\nchmod 600 /etc/rsync.password\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h5",{attrs:{id:"第三个里程碑-实现数据传输"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第三个里程碑-实现数据传输"}},[s._v("#")]),s._v(" 第三个里程碑： 实现数据传输")]),s._v(" "),a("h6",{attrs:{id:"交互式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#交互式"}},[s._v("#")]),s._v(" 交互式")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 ~]# rsync -avzP /etc/hosts rsync_backup@172.16.1.41::backup\nPassword:\nsending incremental file list\nhosts\n         357 100%    0.00kB/s    0:00:00 (xfer#1, to-check=0/1)\n \nsent 63 bytes  received 33 bytes  9.14 bytes/sec\ntotal size is 357  speedup is 3.72\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h6",{attrs:{id:"免交互式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#免交互式"}},[s._v("#")]),s._v(" 免交互式")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 ~]# rsync -avzP /etc/hosts rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password\nsending incremental file list\nhosts\n         357 100%    0.00kB/s    0:00:00 (xfer#1, to-check=0/1)\n \nsent 199 bytes  received 27 bytes  150.67 bytes/sec\ntotal size is 357  speedup is 1.58\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h3",{attrs:{id:"_2-3-rsync守护进程传输数据原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-rsync守护进程传输数据原理"}},[s._v("#")]),s._v(" 2.3 rsync守护进程传输数据原理")]),s._v(" "),a("p",[a("img",{attrs:{src:t(485),alt:"2.3 rsync守护进程传输数据原理"}})]),s._v(" "),a("h3",{attrs:{id:"_2-4-rsync-命令同步参数选项-特殊参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-rsync-命令同步参数选项-特殊参数"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2.4 rsync")]),s._v(" 命令同步参数选项&特殊参数")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[a("strong",[s._v("目录参数")])]),s._v(" "),a("th",[a("strong",[s._v("参数说明")])])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("-v ,--verbose")]),s._v(" "),a("td",[s._v("详细模式输出，传输时的信息")])]),s._v(" "),a("tr",[a("td",[s._v("-z,--compress")]),s._v(" "),a("td",[s._v("传输时进行压缩以提高传输效率  --compress-level=NUM 可按级别压缩  局域网可以不用压缩")])]),s._v(" "),a("tr",[a("td",[s._v("-a,--archive （主要）")]),s._v(" "),a("td",[s._v("归档模式，表示以递归方式传输文件，并保持文件属性。等于 -rtopgDl")])]),s._v(" "),a("tr",[a("td",[s._v("-r,--recursive "),a("strong",[s._v("归档于")]),s._v("**-a**")]),s._v(" "),a("td",[s._v("对子目录以递归模式，即目录下的所有目录都同样传输。小写r")])]),s._v(" "),a("tr",[a("td",[s._v("-t,--times    "),a("strong",[s._v("归档于")]),s._v("**-a**")]),s._v(" "),a("td",[s._v("保持文件时间信息(修改时间)")])]),s._v(" "),a("tr",[a("td",[s._v("-o,--owner    "),a("strong",[s._v("归档于")]),s._v("**-a**")]),s._v(" "),a("td",[s._v("保持文件属主信息")])]),s._v(" "),a("tr",[a("td",[s._v("-p,--perms    "),a("strong",[s._v("归档于")]),s._v("**-a**")]),s._v(" "),a("td",[s._v("保持文件权限")])]),s._v(" "),a("tr",[a("td",[s._v("-g,--group    "),a("strong",[s._v("归档于")]),s._v("**-a**")]),s._v(" "),a("td",[s._v("保持文件属组信息")])]),s._v(" "),a("tr",[a("td",[s._v("-P，--progress")]),s._v(" "),a("td",[s._v("显示同步的过程及传输时的进度等信息（大P）")])]),s._v(" "),a("tr",[a("td",[s._v("-D,--devices  "),a("strong",[s._v("归档于")]),s._v("**-a**")]),s._v(" "),a("td",[s._v("保持设备文件信息")])]),s._v(" "),a("tr",[a("td",[s._v("-l,--links    "),a("strong",[s._v("归档于")]),s._v("**-a**")]),s._v(" "),a("td",[s._v("保留软连接（小写字母l）")])]),s._v(" "),a("tr",[a("td",[s._v("-L")]),s._v(" "),a("td",[s._v("保持链接文件数据信息不变")])]),s._v(" "),a("tr",[a("td",[s._v("-e，--rsh=COMMAND")]),s._v(" "),a("td",[s._v("使用的信道协议（remote  shell），指定替代rsh的shell程序。  例如 ssh")])]),s._v(" "),a("tr",[a("td",[s._v("--exclude="),a("em",[s._v("PATTERN")])]),s._v(" "),a("td",[s._v("指定排除不需要传输的文件信息")])]),s._v(" "),a("tr",[a("td",[s._v("--exclude-from="),a("em",[s._v("file")])]),s._v(" "),a("td",[s._v("文件名所在目录文件，即可以实现排除多个文件")])]),s._v(" "),a("tr",[a("td",[s._v("--bwlimit=RATE")]),s._v(" "),a("td",[s._v("限速功能")])]),s._v(" "),a("tr",[a("td",[s._v("--delete")]),s._v(" "),a("td",[s._v("让目标目录SRC和源目录数据DST一致，即无差异数据同步")])]),s._v(" "),a("tr",[a("td",[a("strong",[s._v("保持同步目录及文件属性：")]),s._v("  这里的-avzP相当于 -vzetopdDlP，生产环境常用的参数为 -avzP  在脚本中可以报-vP去掉  --progress可以用-P代替")]),s._v(" "),a("td")]),s._v(" "),a("tr",[a("td",[a("strong",[s._v("daemon****启动扩展参数")])]),s._v(" "),a("td")]),s._v(" "),a("tr",[a("td",[s._v("--daemon")]),s._v(" "),a("td",[s._v("daemon表示以守护进程的方式启动rsync服务。")])]),s._v(" "),a("tr",[a("td",[s._v("--address")]),s._v(" "),a("td",[s._v("绑定指定IP地址提供服务。")])]),s._v(" "),a("tr",[a("td",[s._v("--config=FILE")]),s._v(" "),a("td",[s._v("更改配置文件路径，而不是默认的/etc/rsyncd.conf")])]),s._v(" "),a("tr",[a("td",[s._v("--port=PORT")]),s._v(" "),a("td",[s._v("更改其它端口提供服务，而不是缺省的873端口")])])])]),s._v(" "),a("h4",{attrs:{id:"_2-4-1-特殊参数实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-1-特殊参数实践"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2.4.1")]),s._v(" 特殊参数实践")]),s._v(" "),a("h5",{attrs:{id:"指定ip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#指定ip"}},[s._v("#")]),s._v(" 指定ip")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup ~]# rsync --daemon --address=172.16.1.41\n[root@backup ~]# netstat -lntup |grep 873\ntcp     0   0 172.16.1.41:873     0.0.0.0:*        LISTEN      2583/rsync   \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h5",{attrs:{id:"参数测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参数测试"}},[s._v("#")]),s._v(" 参数测试")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 ~]# rsync -avzP /etc/services rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password\nsending incremental file list\nservices\n      641020 100%   19.34MB/s    0:00:00 (xfer#1, to-check=0/1)\n \nsent 127417 bytes  received 27 bytes  254888.00 bytes/sec\ntotal size is 641020  speedup is 5.03\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h5",{attrs:{id:"指定配置文件路径"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#指定配置文件路径"}},[s._v("#")]),s._v(" 指定配置文件路径")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup ~]# rsync --daemon --config=/etc/rsyncd.conf\n[root@nfs01 ~]# rsync -avzP /etc/services rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password\nsending incremental file list\nsent 29 bytes  received 8 bytes  74.00 bytes/sec\ntotal size is 641020  speedup is 17324.86\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h5",{attrs:{id:"服务端指定服务端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务端指定服务端口"}},[s._v("#")]),s._v(" 服务端指定服务端口")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup ~]# rsync --daemon --port=5222\n[root@backup ~]# netstat -lntup|grep rsync\ntcp        0      0 0.0.0.0:5222      0.0.0.0:*           LISTEN      2598/rsync         \ntcp        0      0 :::5222            :::*                 LISTEN      2598/rsync  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"_2-4-2-命令小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-2-命令小结"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2.4.2")]),s._v(" 命令小结")]),s._v(" "),a("p",[s._v("让文件权限不改变：")]),s._v(" "),a("p",[s._v("​       让-o和-g参数生效，需要将配置文件uid和gid改为root，然后将fake super参数进行注释")]),s._v(" "),a("h2",{attrs:{id:"第3章-rsycn配置文件详解rsyncd-conf"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第3章-rsycn配置文件详解rsyncd-conf"}},[s._v("#")]),s._v(" 第3章 rsycn配置文件详解rsyncd.conf")]),s._v(" "),a("h3",{attrs:{id:"_3-1-部分知识补充"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-部分知识补充"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.1")]),s._v(" 部分知识补充")]),s._v(" "),a("h4",{attrs:{id:"_3-1-1-配置文件内容参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-配置文件内容参考资料"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.1.1")]),s._v(" 配置文件内容参考资料")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("man rsyncd.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_3-1-2-配置文件内容总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-配置文件内容总结"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.1.2")]),s._v(" 配置文件内容总结")]),s._v(" "),a("p",[s._v("模块之上内容为全局变量信息")]),s._v(" "),a("p",[s._v("模块之下内容为局部变量信息")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("说明：")])]),s._v(" "),a("p",[s._v("无论是全局变量发生变化，还是局部变量发生变化，都建议重启rsync服务使配置生效。")])]),s._v(" "),a("h3",{attrs:{id:"_3-2-利用-etc-init-d-启动rsync服务方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-利用-etc-init-d-启动rsync服务方式"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.2")]),s._v(" 利用/etc/init.d/启动rsync服务方式")]),s._v(" "),a("h4",{attrs:{id:"_3-2-1-可以实现方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-可以实现方式"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.2.1")]),s._v(" 可以实现方式：")]),s._v(" "),a("ol",[a("li",[s._v("编写rsync启动脚本（有一定的shell能力 if case）")]),s._v(" "),a("li",[s._v("利用xinetd服务，管理启动rsync服务")])]),s._v(" "),a("h4",{attrs:{id:"_3-2-2-利用xinetd服务管理rsync"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-利用xinetd服务管理rsync"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.2.2")]),s._v(" 利用xinetd服务管理rsync")]),s._v(" "),a("h5",{attrs:{id:"第一个里程碑-安装xinetd软件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第一个里程碑-安装xinetd软件"}},[s._v("#")]),s._v(" 第一个里程碑： 安装xinetd软件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup ~]# yum install -y xinetd\n[root@backup ~]# rpm -qa |grep xin\nxinetd-2.3.14-40.el6.x86_64\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h5",{attrs:{id:"第二个里程碑-编辑配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第二个里程碑-编辑配置文件"}},[s._v("#")]),s._v(" 第二个里程碑：编辑配置文件")]),s._v(" "),a("p",[s._v("修改disable = yes 改为disable = no")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup ~]# vim /etc/xinetd.d/rsync\n# default: off\n# description: The rsync server is a good addition to an ftp server, as it \\\n#   allows crc checksumming etc.\nservice rsync\n{\ndisable   = no\nflags     = IPv6\nsocket_type     = stream\nwait            = no\nuser            = root\nserver          = /usr/bin/rsync\nserver_args     = --daemon\nlog_on_failure  += USERID\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h5",{attrs:{id:"第三个里程碑-重启xinetd服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第三个里程碑-重启xinetd服务"}},[s._v("#")]),s._v(" 第三个里程碑：重启xinetd服务")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup ~]# /etc/init.d/xinetd restart\nStopping xinetd:                                           [  OK  ]\nStarting xinetd:                                           [  OK  ]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h5",{attrs:{id:"传输测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#传输测试"}},[s._v("#")]),s._v(" 传输测试")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 ~]# rsync -avzP /etc/services rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password\nsending incremental file list\nsent 29 bytes  received 8 bytes  74.00 bytes/sec\ntotal size is 641020  speedup is 17324.86\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"定义变量信息实现免秘钥交互"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定义变量信息实现免秘钥交互"}},[s._v("#")]),s._v(" 定义变量信息实现免秘钥交互")]),s._v(" "),a("h4",{attrs:{id:"_3-3-1-通过man手册获得方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-通过man手册获得方法"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.3.1")]),s._v(" 通过man手册获得方法")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Some  modules  on the remote daemon may require authentication. If so, you will receive a password prompt when you connect.  You  can avoid  the  password  prompt  by  setting the environment variable RSYNC_PASSWORD to the password  you  want  to  use  or  using  the --password-file option. This may be useful when scripting rsync.\nWARNING:  On some systems environment variables are visible to all users. On those systems using --password-file is recommended.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("在远程进程的一些模块可能需要认证。如果是这样的话，你将得到一个密码提示当您连接。你可以通过设置环境变量rsync_password要使用或使用密码文件选项密码避免密码提示。这可能是有用的脚本文件。")]),s._v(" "),a("blockquote",[a("p",[s._v("警告：")]),s._v(" "),a("p",[s._v("在一些系统环境变量，对所有用户都是可见的。在这些系统中使用的密码文件的建议。")])]),s._v(" "),a("h4",{attrs:{id:"_3-3-2-使用rsync-password-变量实现免交互"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-使用rsync-password-变量实现免交互"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.3.2")]),s._v(" 使用RSYNC_PASSWORD 变量实现免交互")]),s._v(" "),a("p",[s._v("未设置变量之前")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 ~]# rsync -avzP /etc/services rsync_backup@172.16.1.41::backup\nPassword:\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("添加上环境变量")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 ~]# export RSYNC_PASSWORD=clsn123\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("测试")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 ~]# rsync -avzP /etc/services rsync_backup@172.16.1.41::backup\nsending incremental file list\nsent 29 bytes  received 8 bytes  24.67 bytes/sec\ntotal size is 641020  speedup is 17324.86\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"_3-3-3-使用-rsync-password文件实现免交互"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-3-使用-rsync-password文件实现免交互"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.3.3")]),s._v(" "),a("strong",[s._v("使用")]),s._v(" rsync.password文件实现免交互")]),s._v(" "),a("p",[s._v("建立密码文档")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('[root@nfs01 ~]# echo "123456">/etc/rsync.password\n[root@nfs01 ~]# chmod 600 /etc/rsync.password\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("命令测试")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 ~]# rsync -avz /etc/hosts rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_3-4-守护进程多模块功能配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-守护进程多模块功能配置"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.4")]),s._v(" 守护进程多模块功能配置")]),s._v(" "),a("h4",{attrs:{id:"第一个里程碑-编写配置信息创建多模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第一个里程碑-编写配置信息创建多模块"}},[s._v("#")]),s._v(" 第一个里程碑： 编写配置信息创建多模块")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('[root@backup ~]# vim /etc/rsyncd.conf\n……\n[nfsdata]\ncomment = "nfsdata dir by clsn"\npath = /backup/nfsdata\n[nfsbackup]\ncomment = "nfsbackup dir by clsn"\npath = /backup/nfsbackup \n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h4",{attrs:{id:"第二个里程碑-创建多模块指定的目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第二个里程碑-创建多模块指定的目录"}},[s._v("#")]),s._v(" 第二个里程碑： 创建多模块指定的目录")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 创建目录，并修改目录的权限\n[root@backup ~]# mkdir /backup/nfs{data,backup} -p\n[root@backup ~]# chown rsync.rsync  /backup/nfs{data,backup}\n#查看：\n[root@backup ~]# ll /backup/nfs{data,backup} -d\ndrwxr-xr-x 2 rsync rsync 4096 Oct 12 10:05 /backup/nfsbackup\ndrwxr-xr-x 2 rsync rsync 4096 Oct 12 10:05 /backup/nfsdata\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h4",{attrs:{id:"第三里程碑-利用rsync客户端进行测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第三里程碑-利用rsync客户端进行测试"}},[s._v("#")]),s._v(" 第三里程碑： 利用rsync客户端进行测试")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 ~]# rsync -avz /data/ rsync_backup@172.16.1.41::nfsdata --password-file=/etc/rsync.passsword\nsending incremental file list\n./\nnfs.data\nsent 78 bytes  received 30 bytes  216.00 bytes/sec\ntotal size is 0  speedup is 0.00\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("blockquote",[a("p",[s._v("说明：")]),s._v(" "),a("p",[a("em",[s._v("rsyncd.conf配置文件中，添加多模块信息，可以不用重启rsync服务，即时生效~")])]),s._v(" "),a("p",[a("em",[s._v("全局变量参数针对所有模块生效；局部变量参数只针对指定模块生效")])]),s._v(" "),a("p",[a("em",[s._v("read only参数默认配置为ture，即为只读模式")])]),s._v(" "),a("p",[a("em",[s._v("全局变量发生变化，不用重启"),a("strong",[s._v("rsync")]),s._v("服务；局部变量发生变化，需要重启"),a("strong",[s._v("rsync")]),s._v("服务")])])]),s._v(" "),a("blockquote",[a("p",[s._v("注意：修改配置文件就重启"),a("strong",[s._v("↓")])]),s._v(" "),a("p",[s._v("无论是全局变量发生变化，还是局部变量发生变化，都建议重启rsync服务使配置生效")])]),s._v(" "),a("h3",{attrs:{id:"_3-5-守护进程的排除功能实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-守护进程的排除功能实践"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.5")]),s._v(" 守护进程的排除功能实践")]),s._v(" "),a("h4",{attrs:{id:"_3-5-1-排除的方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-1-排除的方式"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.5.1")]),s._v(" 排除的方式")]),s._v(" "),a("ol",[a("li",[s._v("--exclude=要配置的目录或文件名称")]),s._v(" "),a("li",[s._v("--exclude-from=要排除多个目录或文件汇总文件名称")]),s._v(" "),a("li",[s._v("在配置文件中进行修改，指定要排除的信息")])]),s._v(" "),a("h4",{attrs:{id:"_3-5-2-排除测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-2-排除测试"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.5.2")]),s._v(" 排除测试")]),s._v(" "),a("h5",{attrs:{id:"第一个里程碑-创建模拟测试环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第一个里程碑-创建模拟测试环境"}},[s._v("#")]),s._v(" 第一个里程碑: 创建模拟测试环境")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 data]# mkdir {a..d}\n[root@nfs01 data]# touch {a..d}/{1..3}.txt\n[root@nfs01 data]# tree\n.\n├── a\n│   ├── 1.txt\n│   ├── 2.txt\n│   └── 3.txt\n├── b\n│   ├── 1.txt\n│   ├── 2.txt\n│   └── 3.txt\n├── c\n│   ├── 1.txt\n│   ├── 2.txt\n│   └── 3.txt\n└── d\n    ├── 1.txt\n    ├── 2.txt\n    └── 3.txt\n4 directories, 12 files\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h5",{attrs:{id:"第二个里程碑-利用-exclude参数测试排除功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第二个里程碑-利用-exclude参数测试排除功能"}},[s._v("#")]),s._v(" 第二个里程碑 利用 --exclude参数测试排除功能")]),s._v(" "),a("p",[s._v("# 需求：不要a目录中3.txt 不要b、c目录")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 data]# rsync -avz /data/ --exclude=a/3.txt --exclude=b --exclude=c rsync_backup@172.16.1.41::nfsdata\nsending incremental file list\n./\na/\na/1.txt\na/2.txt\nd/\nd/1.txt\nd/2.txt\nd/3.txt\nsent 300 bytes  received 114 bytes  828.00 bytes/sec\ntotal size is 0  speedup is 0.00\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("精简方式排除")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 data]# rsync -avz /data/ --exclude=a/3.txt --exclude={b,c} rsync_backup@172.16.1.41::nfsdata\nsending incremental file list\n./\na/\na/1.txt\na/2.txt\nd/\nd/1.txt\nd/2.txt\nd/3.txt\nsent 300 bytes  received 114 bytes  828.00 bytes/sec\ntotal size is 0  speedup is 0.00\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h4",{attrs:{id:"_3-5-3-利用-exclude-from方式进行排除"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-3-利用-exclude-from方式进行排除"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.5.3")]),s._v(" 利用--exclude-from方式进行排除")]),s._v(" "),a("h5",{attrs:{id:"第一个里程碑-创建模拟测试环境-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第一个里程碑-创建模拟测试环境-2"}},[s._v("#")]),s._v(" 第一个里程碑: 创建模拟测试环境")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 data]# mkdir {a..d}\n[root@nfs01 data]# touch {a..d}/{1..3}.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h5",{attrs:{id:"第二个里程碑-利用-exlude-from参数-测试排除功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第二个里程碑-利用-exlude-from参数-测试排除功能"}},[s._v("#")]),s._v(" 第二个里程碑：利用--exlude-from参数，测试排除功能")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 data]# vim /tmp/paichu.txt\na/3.txt\nb\nc\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h5",{attrs:{id:"第三个里程碑-进行排除"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第三个里程碑-进行排除"}},[s._v("#")]),s._v(" 第三个里程碑：进行排除")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 data]# rsync -avz /data/ --exclude-from=/tmp/paichu.txt rsync_backup@172.16.1.41::nfsdata\nsending incremental file list\n./\na/\na/1.txt\na/2.txt\nd/\nd/1.txt\nd/2.txt\nd/3.txt\nsent 300 bytes  received 114 bytes  828.00 bytes/sec\ntotal size is 0  speedup is 0.00\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("blockquote",[a("p",[s._v("说明：")]),s._v(" "),a("p",[a("em",[s._v("01. 排除文件中，需要利用相对路径指定排除信息（不能利用绝对路径）")])]),s._v(" "),a("p",[a("em",[s._v("02.")]),s._v(" "),a("em",[s._v("相对路径指的是相对同步的目录信息而言，是对**rsync -avz /data/")]),s._v(" "),a("em",[s._v("后面的"),a("strong",[s._v("data")]),s._v("目录进行相对")])])]),s._v(" "),a("h4",{attrs:{id:"_3-5-4-在配置文件中修改要排除的文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-4-在配置文件中修改要排除的文件"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.5.4")]),s._v(" "),a("strong",[s._v("在配置文件中修改要排除的文件")])]),s._v(" "),a("h5",{attrs:{id:"第一个里程碑-编写修改服务端配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第一个里程碑-编写修改服务端配置文件"}},[s._v("#")]),s._v(" 第一个里程碑： 编写修改服务端配置文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('vim /etc/rsyncd.conf\n[nfsdata]\ncomment = "nfsdata dir by clsn"\npath = /backup/nfsdata\nexclude=a/3.txt b c\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h5",{attrs:{id:"第二个里程碑-重启rsync服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第二个里程碑-重启rsync服务"}},[s._v("#")]),s._v(" 第二个里程碑：重启rsync服务")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("killall rsync && sleep 1 && rsync --daemon\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h5",{attrs:{id:"第三里程碑-进行测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第三里程碑-进行测试"}},[s._v("#")]),s._v(" 第三里程碑： 进行测试")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('[root@nfs01 data]# rsync -avz /data/  rsync_backup@172.16.1.41::nfsdata\nsending incremental file list\n./\na/\na/1.txt\na/2.txt\nskipping daemon-excluded file "a/3.txt"\nskipping daemon-excluded directory "b"\n*** Skipping any contents from this failed directory ***\nskipping daemon-excluded directory "c"\n*** Skipping any contents from this failed directory ***\nd/\nd/1.txt\nd/2.txt\nd/3.txt\nsent 407 bytes  received 116 bytes  1046.00 bytes/sec\ntotal size is 0  speedup is 0.00\nrsync error: some files/attrs were not transferred (see previous errors) (code 23) at main.c(1039) [sender=3.0.6]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("h3",{attrs:{id:"_3-6-守护进程来创建备份目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-守护进程来创建备份目录"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.6")]),s._v(" "),a("strong",[s._v("守护进程来创建备份目录")])]),s._v(" "),a("p",[s._v("通过客户端命令创建服务端备份目录中子目录")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("推送/etc/services文件到 服务器/backup/sda/目录")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 ~]# rsync -avzP /etc/services rsync_backup@172.16.1.41::backup/dba/\nsending incremental file list\ncreated directory dba\nservices\n      641020 100%   19.34MB/s    0:00:00 (xfer#1, to-check=0/1)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("推送/etc/services文件到 服务器/backup/sa/目录")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sent 127417 bytes  received 27 bytes  254888.00 bytes/sec\ntotal size is 641020  speedup is 5.03\n[root@nfs01 ~]# rsync -avzP /etc/services rsync_backup@172.16.1.41::backup/sa/\nsending incremental file list\ncreated directory sa\nservices\n      641020 100%   19.34MB/s    0:00:00 (xfer#1, to-check=0/1)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("推送/etc/services文件到 服务器/backup/dev/目录")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sent 127417 bytes  received 27 bytes  254888.00 bytes/sec\ntotal size is 641020  speedup is 5.03\n[root@nfs01 ~]# rsync -avzP /etc/services rsync_backup@172.16.1.41::backup/dev/\nsending incremental file list\ncreated directory dev\nservices\n      641020 100%   18.71MB/s    0:00:00 (xfer#1, to-check=0/1)\n \nsent 127417 bytes  received 27 bytes  254888.00 bytes/sec\ntotal size is 641020  speedup is 5.03\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("检查结果：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup backup]# tree\n.\n├── dba\n│   └── services\n├── dev\n│   └── services\n└── sa\n    └── services\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("blockquote",[a("p",[s._v("说明：")]),s._v(" "),a("p",[a("em",[s._v('a 目标目录名称后要加上 "/", 表示创建目录，否则变为修改传输文件名称了')])]),s._v(" "),a("p",[a("em",[s._v("b")]),s._v(" "),a("em",[s._v("利用客户端创建服务备份子目录时，只能创建一级子目录")]),s._v("*，不能创建多级子目录**。*")])])])]),s._v(" "),a("h3",{attrs:{id:"_3-7-守护进程的访问控制配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-7-守护进程的访问控制配置"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.7")]),s._v(" "),a("strong",[s._v("守护进程的访问控制配置")])]),s._v(" "),a("h4",{attrs:{id:"第一个里程碑-在服务端配置文件-编写白名单策略或黑名单策略-只能取其一"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第一个里程碑-在服务端配置文件-编写白名单策略或黑名单策略-只能取其一"}},[s._v("#")]),s._v(" 第一个里程碑：在服务端配置文件，编写白名单策略或黑名单策略（只能取其一）")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("vim /etc/rsyncd.conf\n    hosts allow = 172.16.1.0/24\n    #hosts deny = 0.0.0.0/32\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("关于访问控制的说明：")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("白名单和黑名单同时存在时，默认控制策略为不匹配的传输数据信息全部放行")])]),s._v(" "),a("li",[a("p",[s._v("白名单单一存在时，默认控制策略为不匹配的传输数据信息全部禁止")])]),s._v(" "),a("li",[a("p",[s._v("黑名单单一存在时，默认控制策略为不匹配的传输数据信息全部放行")])]),s._v(" "),a("li",[a("p",[s._v("白名单优先于黑名单")])])]),s._v(" "),a("blockquote",[a("p",[s._v("全局变量修改控制策略信息，rsync服务必须重启")])]),s._v(" "),a("h4",{attrs:{id:"第二个里程碑-客户端进行测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第二个里程碑-客户端进行测试"}},[s._v("#")]),s._v(" 第二个里程碑：客户端进行测试")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 backup]# rsync -avz /etc/services rsync_backup@10.0.0.41::data\n@ERROR: Unknown module 'data'\nrsync error: error starting client-server protocol (code 5) at main.c(1503) [sender=3.0.6]\n--------------------------------------------------------------------------------\n[root@nfs01 backup]# rsync -avz /etc/services sync_backup@172.16.1.41::data\nsending incremental file list\nsent 29 bytes  received 8 bytes  74.00 bytes/sec\ntotal size is 641020  speedup is 17324.86\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"_3-8-守护进程无差异同步配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-8-守护进程无差异同步配置"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.8")]),s._v(" "),a("strong",[s._v("守护进程无差异同步配置")])]),s._v(" "),a("h4",{attrs:{id:"_3-8-1-什么是无差异"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-8-1-什么是无差异"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.8.1")]),s._v(" "),a("strong",[s._v("什么是无差异：")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("推模式：我有什么，你就有什么；我没有，你也不能有")])]),s._v(" "),a("li",[a("p",[s._v("拉模式：你有什么，我就有什么；你没有，我也不能有")])])]),s._v(" "),a("blockquote",[a("p",[s._v("总结："),a("strong",[s._v("服务端客户端数据完全一致（一模一样）")])])]),s._v(" "),a("h4",{attrs:{id:"_3-8-2-实现无差异同步方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-8-2-实现无差异同步方法"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.8.2")]),s._v(" "),a("strong",[s._v("实现无差异同步方法")])]),s._v(" "),a("h5",{attrs:{id:"第一个里程碑-创建实验环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第一个里程碑-创建实验环境"}},[s._v("#")]),s._v(" 第一个里程碑： 创建实验环境")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 ~]# ll /data/\ntotal 16\ndrwxr-xr-x 2 root root 4096 Oct 12 10:29 a\ndrwxr-xr-x 2 root root 4096 Oct 12 10:40 b\ndrwxr-xr-x 2 root root 4096 Oct 12 10:29 c\ndrwxr-xr-x 2 root root 4096 Oct 12 10:29 d\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h5",{attrs:{id:"第二个里程-进行第一次数据同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第二个里程-进行第一次数据同步"}},[s._v("#")]),s._v(" 第二个里程：进行第一次数据同步")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 ~]# rsync -avz --delete  /data/ rsync_backup@172.16.1.41::backup/\nsending incremental file list\n./\na/\na/1.txt\na/2.txt\na/3.txt\nb/\nb/1.txt\nb/2.txt\nb/3.txt\nc/\nc/1.txt\nc/2.txt\nc/3.txt\nd/\nd/1.txt\nd/2.txt\nd/3.txt\nsent 669 bytes  received 255 bytes  1848.00 bytes/sec\ntotal size is 0  speedup is 0.00\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h5",{attrs:{id:"第三个里程-删除指定目录-并添加指定文件-测试无差异功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第三个里程-删除指定目录-并添加指定文件-测试无差异功能"}},[s._v("#")]),s._v(" 第三个里程：删除指定目录，并添加指定文件，测试无差异功能")]),s._v(" "),a("p",[s._v("删除客户端中的 a/ 目录，再进行无差异传输")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@nfs01 data]# rm a/ -rf\n[root@nfs01 data]# rsync -avz --delete  /data/ rsync_backup@172.16.1.41::backup/\nsending incremental file list\n./\ndeleting a/3.txt\ndeleting a/2.txt\ndeleting a/1.txt\ndeleting a/\nsent 181 bytes  received 14 bytes  390.00 bytes/sec\ntotal size is 0  speedup is 0.00\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h4",{attrs:{id:"【注意】无差异同步方法的应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【注意】无差异同步方法的应用"}},[s._v("#")]),s._v(" 【注意】无差异同步方法的应用")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("实现储存数据与备份数据完全一致（"),a("strong",[s._v("慎用")]),s._v("）")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("rsync -avz --delete  /data/ rsync_backup@172.16.1.41::backup /\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("快速删除大文件数据")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mkdir /null      --创建出一个空目录。\nrsync -avz --delete /null/ /bigdata/\n# 删除效率高于 rm -rf /bigdata\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"_3-9-守护进程的列表功能配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-9-守护进程的列表功能配置"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.9")]),s._v(" "),a("strong",[s._v("守护进程的列表功能配置")])]),s._v(" "),a("h4",{attrs:{id:"第一个里程碑-在服务端配置文件中开启list列表功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第一个里程碑-在服务端配置文件中开启list列表功能"}},[s._v("#")]),s._v(" 第一个里程碑： 在服务端配置文件中开启list列表功能")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup ~]# vim /etc/rsyncd.conf\nlist = true\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"第二个里程碑-重启rsync服务-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第二个里程碑-重启rsync服务-2"}},[s._v("#")]),s._v(" 第二个里程碑：重启rsync服务")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup ~]# killall rsync && sleep 1 && rsync --daemon\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"第三个里程碑-客户端查看服务端模块信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第三个里程碑-客户端查看服务端模块信息"}},[s._v("#")]),s._v(" 第三个里程碑： 客户端查看服务端模块信息")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('[root@nfs01 data]# rsync rsync_backup@172.16.1.41::\nbackup         "backup dir by clsn"\nnfsdata        "nfsdata dir by clsn"\nnfsbackup      "nfsbackup dir by clsn"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("blockquote",[a("p",[s._v("说明：")]),s._v(" "),a("p",[s._v("为了提升备份服务器安全性，建议关闭list列表功能")])]),s._v(" "),a("h3",{attrs:{id:"_4-0-备份文件完整性检查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-0-备份文件完整性检查"}},[s._v("#")]),s._v(" "),a("strong",[s._v("4.0")]),s._v(" "),a("strong",[s._v("备份文件完整性检查")])]),s._v(" "),a("h4",{attrs:{id:"_4-0-1客户端生成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-0-1客户端生成"}},[s._v("#")]),s._v(" 4.0.1客户端生成")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("md5sum ljq.txt                   //生成这个文件的md5效验值\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_4-0-2服务端对比效验"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-0-2服务端对比效验"}},[s._v("#")]),s._v(" 4.0.2服务端对比效验")]),s._v(" "),a("p",[s._v("md5sum -c 指纹文件命令执行原理")]),s._v(" "),a("ol",[a("li",[s._v("打开一个指纹文件，将信息记录到缓存中")]),s._v(" "),a("li",[s._v("根据指纹文件的路径，生成md5的数值")]),s._v(" "),a("li",[s._v("将新生成md5数值和原有指纹文件数值进行比较")]),s._v(" "),a("li",[s._v("如过相同显示结果为ok，如果不同显示failed")])]),s._v(" "),a("h3",{attrs:{id:"_4-1-守护进程服务企业应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-守护进程服务企业应用"}},[s._v("#")]),s._v(" "),a("strong",[s._v("4.1")]),s._v(" "),a("strong",[s._v("守护进程服务企业应用")])]),s._v(" "),a("p",[s._v("守护进程多模块功能配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('[backup]                                                                   \ncomment = "backup dir by clsn"                                   \npath = /backup \n[dba]                                                                   \ncomment = "backup dir by clsn"                                   \npath = /dba\n[dev]                                                                   \ncomment = "backup dir by clsn"                                   \npath = /dev\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("blockquote",[a("p",[s._v("ps：可以划分多个部门，不同部门的主机分布存放不同的文件夹下")])]),s._v(" "),a("p",[s._v("守护进程的排除功能实践")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[ljq@LN /]$mkdir -p rsync_exclude\n[ljq@LN /]$mkdir -p rsync_exclude/{a..c}\n[ljq@LN /]$touch rsync_exclude/{a..c}/{1..3}.txt\n[ljq@LN /]$tree rsync_exclude/\nrsync_exclude/\n├── a\n│   ├── 1.txt\n│   ├── 2.txt\n│   └── 3.txt\n├── b\n│   ├── 1.txt\n│   ├── 2.txt\n│   └── 3.txt\n└── c\n\t\t├── 1.txt\n\t\t├── 2.txt\n\t\t└── 3.txt\n\t\t\t\t\n3 directories, 9 files\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("h4",{attrs:{id:"_4-1-1-需求1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-1-需求1"}},[s._v("#")]),s._v(" 4.1.1 需求1")]),s._v(" "),a("p",[s._v("将/rsync_exlude目录下 a目录数据全部备份 b目录不要备份1.txt文件 c整个目录不要做备份")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("绝对路径")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("rsync -avz /rsync_excluude --exclude=/rsync_exclude/b/1.txt --exclude=/rsync_exclude/c/ rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("相对路径")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("rsync -avz /rsync_excluude --exclude=b/1.txt --exclude=c/ rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"_4-2企业中应用实例-及发送邮箱配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2企业中应用实例-及发送邮箱配置"}},[s._v("#")]),s._v(" "),a("strong",[s._v("4.2")]),s._v("企业中应用实例，及发送邮箱配置")]),s._v(" "),a("h4",{attrs:{id:"_4-2-1-实现发送邮件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-1-实现发送邮件"}},[s._v("#")]),s._v(" 4.2.1 实现发送邮件")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("配置163企业邮箱")])]),s._v(" "),a("li",[a("p",[s._v("编写Linux服务邮件相关配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("vim /etc/mail.rc\nset from=13164646190@163.com smtp=smtp.163.com\nset smtp-auth-user=13164646190@163.com smtp-auth-password=授权密码 smtp-auth=login\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("重启自带的邮件服务")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("systemctl restart postfix.service\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("发送邮件测试")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('echo "邮件发送测试" | mail -s “邮件测试”目标邮箱\nmail -s “邮件测试”目标邮箱 < /etc/hosts   //以hosts文件为文件内容发送\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])])]),s._v(" "),a("h4",{attrs:{id:"_4-2-2编写全网备份脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-2编写全网备份脚本"}},[s._v("#")]),s._v(" 4.2.2编写全网备份脚本")]),s._v(" "),a("p",[s._v("客户端脚本")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('mkdir /server/scripts -p     //建立一个专门放脚本的文件\nvim backup.sh\n#!/bin/bash\n\t\t\t\t\t\t\nBackup_dir="/backup"      //定义变量，方便更换\nIP_info=$(hostname -i)\n\t\t\t\t\t\t\n#create backup dir\nmkdir -p $Backup_dir/$IP_info/\n\t\t\t\t\t\t\n#tar backup data\ncd /\ntar zcvf $Backup_dir/$IP_info/date_$(date +%F_week%w -d -1day).tar.gz /etc/hosts\n\t\t\t\t\t\t\n#del 7 day ago date\nfind $Backup_dir -type f -mtime +7 | xargs rm 2>/dev/null\n\t\t\t\t\t\t\n#create finger file\nfind $Backup_dir/ -type f -mtime -1 ! -name "finger*" | xargs md5sum > $Backup_dir/$IP_info/finger.txt\n\t\t\t\t\t\t\n#backup push data info\nrsync -avz $Backup_dir/ rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[s._v("服务端脚本")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('mkdir /server/scripts -p  \nmkdir -p /backup/10.0.0.31/\nvim backup-server.sh\n#!/bin/bash\n\t\t\t\t\t\t\n#del 180 day ago data\nind /backup/ -type f -mtime +180 ! -name "*week1.tar.gz" | xargs rm 2>/dev/null\n\t\t\t\t\t\t\n#check backup data\nfind /backup/ -type f -name "finger.txt" | xargs md5sum -c >/tmp/check.txt\n\t\t\t\t\t\t\n#send check mail\nmail -s "check backup info for $(date +%F)" 2044307912@qq.com</tmp/check.txt\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h4",{attrs:{id:"_4-2-3-实现自动完成全网数据备份-定时任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-3-实现自动完成全网数据备份-定时任务"}},[s._v("#")]),s._v(" 4.2.3 实现自动完成全网数据备份（定时任务）")]),s._v(" "),a("p",[s._v("客户端定时任务")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("crontab -e\n# backup data\n0 0 * * * /bin/sh  /server/scripts/backup.sh &>/dev/null\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("服务端定时任务")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("crontab -e\n# backup data\n0 5 * * * /bin/sh  /server/scripts/backup-server.sh &>/dev/null\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"第4章-小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第4章-小结"}},[s._v("#")]),s._v(" "),a("strong",[s._v("第")]),s._v("4章 "),a("strong",[s._v("小结")])]),s._v(" "),a("p",[s._v("在使用rsync备份目录时")]),s._v(" "),a("ol",[a("li",[s._v("备份目录后面有 / -- /ljqfile/ ： 只会将目录下面的内容进行备份传输")]),s._v(" "),a("li",[s._v("备份目录后面没有 / -- /ljqfile ： 会将目录本身及下面的内容进行备份传输")])]),s._v(" "),a("p",[s._v("rsync服务部署安装过程")]),s._v(" "),a("ol",[a("li",[s._v("下载安装软件 yum")]),s._v(" "),a("li",[s._v("编写配置文件")]),s._v(" "),a("li",[s._v("搭建服务环境 备份的目录/目录权限")]),s._v(" "),a("li",[s._v("启动服务程序  开机自动启动")]),s._v(" "),a("li",[s._v("测试服务功能")])]),s._v(" "),a("h2",{attrs:{id:"第5章-常见问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第5章-常见问题"}},[s._v("#")]),s._v(" "),a("strong",[s._v("第")]),s._v("5章 "),a("strong",[s._v("常见问题")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('[root@nfs01 tmp]# rsync -avz /etc/hosts  rsync_backup@172.16.1.41::backup\nPassword:\nsending incremental file list\nhosts\nrsync: mkstemp ".hosts.U5OCyR" (in backup) failed: Permission denied (13)\nsent 200 bytes  received 27 bytes  13.76 bytes/sec\ntotal size is 371  speedup is 1.63\nrsync error: some files/attrs were not transferred (see previous errors) (code 23) at main.c(1039) [sender=3.0.6]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("blockquote",[a("p",[s._v("说明：备份目录权限设置不正确")])]),s._v(" "),a("p",[s._v("解决办法：")]),s._v(" "),a("p",[s._v("将服务端的备份存放目录（path值），属主和属组修改为rsync。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@backup ~]# chown -R rsync.rsync /backup/ \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:t(486),alt:"问题1"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(487),alt:"问题2"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(488),alt:"问题3"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(489),alt:"问题4"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(490),alt:"问题5"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(491),alt:"问题6"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(492),alt:"问题7"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(493),alt:"问题8"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(494),alt:"问题9"}})])])}),[],!1,null,null,null);a.default=e.exports}}]);