<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>配置DNS服务 | 失控</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="失控的个人经验学习分享！">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.cd4efee1.css" as="style"><link rel="preload" href="/assets/js/app.4cb69ec2.js" as="script"><link rel="preload" href="/assets/js/4.1668cfe5.js" as="script"><link rel="preload" href="/assets/js/1.9ad7271c.js" as="script"><link rel="preload" href="/assets/js/41.2921d41f.js" as="script"><link rel="prefetch" href="/assets/js/10.bad3f5f9.js"><link rel="prefetch" href="/assets/js/11.298ea54e.js"><link rel="prefetch" href="/assets/js/12.a643b30c.js"><link rel="prefetch" href="/assets/js/13.e4752110.js"><link rel="prefetch" href="/assets/js/14.7c86cbe6.js"><link rel="prefetch" href="/assets/js/15.7ca87b5c.js"><link rel="prefetch" href="/assets/js/16.b5695561.js"><link rel="prefetch" href="/assets/js/17.1213d457.js"><link rel="prefetch" href="/assets/js/18.5b56736f.js"><link rel="prefetch" href="/assets/js/19.6e61fde6.js"><link rel="prefetch" href="/assets/js/20.3945d2cc.js"><link rel="prefetch" href="/assets/js/21.0e40cef9.js"><link rel="prefetch" href="/assets/js/22.e073bbdb.js"><link rel="prefetch" href="/assets/js/23.d568ea56.js"><link rel="prefetch" href="/assets/js/24.3ef5407f.js"><link rel="prefetch" href="/assets/js/25.c2f39a7b.js"><link rel="prefetch" href="/assets/js/26.c4100c92.js"><link rel="prefetch" href="/assets/js/27.1424ba6c.js"><link rel="prefetch" href="/assets/js/28.2e503c28.js"><link rel="prefetch" href="/assets/js/29.50e65abc.js"><link rel="prefetch" href="/assets/js/3.d8295d2c.js"><link rel="prefetch" href="/assets/js/30.0bccaa09.js"><link rel="prefetch" href="/assets/js/31.9bd1ed8f.js"><link rel="prefetch" href="/assets/js/32.0ee12825.js"><link rel="prefetch" href="/assets/js/33.085b61a8.js"><link rel="prefetch" href="/assets/js/34.6991faa5.js"><link rel="prefetch" href="/assets/js/35.90877f26.js"><link rel="prefetch" href="/assets/js/36.faa70960.js"><link rel="prefetch" href="/assets/js/37.f82a3d33.js"><link rel="prefetch" href="/assets/js/38.2489ed3e.js"><link rel="prefetch" href="/assets/js/39.2106446e.js"><link rel="prefetch" href="/assets/js/40.cb46a1bd.js"><link rel="prefetch" href="/assets/js/42.4bd7d59c.js"><link rel="prefetch" href="/assets/js/43.f9919baf.js"><link rel="prefetch" href="/assets/js/44.3c22a603.js"><link rel="prefetch" href="/assets/js/45.401b34a0.js"><link rel="prefetch" href="/assets/js/46.27378c9d.js"><link rel="prefetch" href="/assets/js/47.74864cee.js"><link rel="prefetch" href="/assets/js/48.b01e52ac.js"><link rel="prefetch" href="/assets/js/49.4eb24d0e.js"><link rel="prefetch" href="/assets/js/5.af3e9c19.js"><link rel="prefetch" href="/assets/js/50.81e68ecc.js"><link rel="prefetch" href="/assets/js/51.cbdca9b9.js"><link rel="prefetch" href="/assets/js/52.15e4afa3.js"><link rel="prefetch" href="/assets/js/53.6e373a99.js"><link rel="prefetch" href="/assets/js/6.78ae3d22.js"><link rel="prefetch" href="/assets/js/7.9b768441.js"><link rel="prefetch" href="/assets/js/8.e992d174.js"><link rel="prefetch" href="/assets/js/9.0b2d7833.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cd4efee1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-6f8f7dda><div data-v-6f8f7dda><div class="password-shadow password-wrapper-out" style="display:none;" data-v-f68096de data-v-6f8f7dda data-v-6f8f7dda><h3 class="title" data-v-f68096de>失控</h3> <p class="description" data-v-f68096de>失控的个人经验学习分享！</p> <label id="box" class="inputBox" data-v-f68096de><input type="password" value="" data-v-f68096de> <span data-v-f68096de>Konck! Knock!</span> <button data-v-f68096de>OK</button></label> <div class="footer" data-v-f68096de><span data-v-f68096de><i class="iconfont reco-theme" data-v-f68096de></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-f68096de>vuePress-theme-reco</a></span> <span data-v-f68096de><i class="iconfont reco-copyright" data-v-f68096de></i> <a data-v-f68096de><span data-v-f68096de>贪吃偷懒的猫</span>
          
        <span data-v-f68096de>2021 - </span>
        2023
      </a></span></div></div> <div class="hide" data-v-6f8f7dda><header class="navbar" data-v-6f8f7dda><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">失控</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Linux/" class="nav-link"><i class="undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/Markdown/" class="nav-link"><i class="undefined"></i>
  Markdown
</a></li><li class="dropdown-item"><!----> <a href="/categories/Hexo/" class="nav-link"><i class="undefined"></i>
  Hexo
</a></li><li class="dropdown-item"><!----> <a href="/categories/Ubuntu/" class="nav-link"><i class="undefined"></i>
  Ubuntu
</a></li><li class="dropdown-item"><!----> <a href="/categories/个人博客/" class="nav-link"><i class="undefined"></i>
  个人博客
</a></li><li class="dropdown-item"><!----> <a href="/categories/Openstack/" class="nav-link"><i class="undefined"></i>
  Openstack
</a></li><li class="dropdown-item"><!----> <a href="/categories/云计算运维综合架构/" class="nav-link"><i class="undefined"></i>
  云计算运维综合架构
</a></li><li class="dropdown-item"><!----> <a href="/categories/源码服务搭建/" class="nav-link"><i class="undefined"></i>
  源码服务搭建
</a></li><li class="dropdown-item"><!----> <a href="/categories/计算机网络/" class="nav-link"><i class="undefined"></i>
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/categories/神州数码/" class="nav-link"><i class="undefined"></i>
  神州数码
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/blogs/donate/donate.html" class="nav-link"><i class="iconfont reco-blog"></i>
  Donate
</a></div><div class="nav-item"><a href="/blogs/about/about.html" class="nav-link"><i class="iconfont reco-account"></i>
  About
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-menu"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://forum.cndis.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-message"></i>
  DisFor论坛
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-6f8f7dda></div> <aside class="sidebar" data-v-6f8f7dda><div class="personal-info-wrapper" data-v-cc06b9e8 data-v-6f8f7dda><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-cc06b9e8> <h3 class="name" data-v-cc06b9e8>
    贪吃偷懒的猫
  </h3> <div class="num" data-v-cc06b9e8><div data-v-cc06b9e8><h3 data-v-cc06b9e8>42</h3> <h6 data-v-cc06b9e8>文章</h6></div> <div data-v-cc06b9e8><h3 data-v-cc06b9e8>88</h3> <h6 data-v-cc06b9e8>标签</h6></div></div> <ul class="social-links" data-v-cc06b9e8></ul> <hr data-v-cc06b9e8></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Linux/" class="nav-link"><i class="undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/Markdown/" class="nav-link"><i class="undefined"></i>
  Markdown
</a></li><li class="dropdown-item"><!----> <a href="/categories/Hexo/" class="nav-link"><i class="undefined"></i>
  Hexo
</a></li><li class="dropdown-item"><!----> <a href="/categories/Ubuntu/" class="nav-link"><i class="undefined"></i>
  Ubuntu
</a></li><li class="dropdown-item"><!----> <a href="/categories/个人博客/" class="nav-link"><i class="undefined"></i>
  个人博客
</a></li><li class="dropdown-item"><!----> <a href="/categories/Openstack/" class="nav-link"><i class="undefined"></i>
  Openstack
</a></li><li class="dropdown-item"><!----> <a href="/categories/云计算运维综合架构/" class="nav-link"><i class="undefined"></i>
  云计算运维综合架构
</a></li><li class="dropdown-item"><!----> <a href="/categories/源码服务搭建/" class="nav-link"><i class="undefined"></i>
  源码服务搭建
</a></li><li class="dropdown-item"><!----> <a href="/categories/计算机网络/" class="nav-link"><i class="undefined"></i>
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/categories/神州数码/" class="nav-link"><i class="undefined"></i>
  神州数码
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/blogs/donate/donate.html" class="nav-link"><i class="iconfont reco-blog"></i>
  Donate
</a></div><div class="nav-item"><a href="/blogs/about/about.html" class="nav-link"><i class="iconfont reco-account"></i>
  About
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-menu"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://forum.cndis.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-message"></i>
  DisFor论坛
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-f68096de data-v-6f8f7dda><h3 class="title" data-v-f68096de>配置DNS服务</h3> <!----> <label id="box" class="inputBox" data-v-f68096de><input type="password" value="" data-v-f68096de> <span data-v-f68096de>Konck! Knock!</span> <button data-v-f68096de>OK</button></label> <div class="footer" data-v-f68096de><span data-v-f68096de><i class="iconfont reco-theme" data-v-f68096de></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-f68096de>vuePress-theme-reco</a></span> <span data-v-f68096de><i class="iconfont reco-copyright" data-v-f68096de></i> <a data-v-f68096de><span data-v-f68096de>贪吃偷懒的猫</span>
          
        <span data-v-f68096de>2021 - </span>
        2023
      </a></span></div></div> <div data-v-6f8f7dda><div data-v-6f8f7dda><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">配置DNS服务</h1> <div data-v-1e62957f><i class="iconfont reco-account" data-v-1e62957f><span data-v-1e62957f>贪吃偷懒的猫</span></i> <i class="iconfont reco-date" data-v-1e62957f><span data-v-1e62957f>2021/9/18</span></i> <!----> <i class="tags iconfont reco-tag" data-v-1e62957f><span class="tag-item" data-v-1e62957f>Linux</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="第一章-配置单个dns"><a href="#第一章-配置单个dns" class="header-anchor">#</a> 第一章 配置单个DNS</h2> <h3 id="_1-1-安装dns"><a href="#_1-1-安装dns" class="header-anchor">#</a> 1.1 安装DNS</h3> <p>获取DNS所有的软件包</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>yum <span class="token function">install</span> bind*
或
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token builtin class-name">bind</span> bind-chroot bind-utils
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_1-2-配置dns文件"><a href="#_1-2-配置dns文件" class="header-anchor">#</a> 1.2 配置DNS文件</h3> <h4 id="_1-2-1-修改dns主配置文件"><a href="#_1-2-1-修改dns主配置文件" class="header-anchor">#</a> 1.2.1 修改DNS主配置文件</h4> <div class="language-vim line-numbers-mode"><pre class="language-vim"><code><span class="token keyword">vi</span> <span class="token operator">/</span>etc<span class="token operator">/</span>named<span class="token operator">.</span><span class="token keyword">conf</span> 
	修改：
		listen<span class="token operator">-</span><span class="token keyword">on</span> port <span class="token number">53</span> <span class="token punctuation">{</span> any<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
		allow<span class="token operator">-</span>query     <span class="token punctuation">{</span> any<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_1-2-2-修改、反向解析配置文件"><a href="#_1-2-2-修改、反向解析配置文件" class="header-anchor">#</a> 1.2.2 修改、反向解析配置文件</h4> <div class="language-vim line-numbers-mode"><pre class="language-vim"><code><span class="token keyword">vi</span> <span class="token operator">/</span>etc<span class="token operator">/</span>named<span class="token operator">.</span>rfc1912<span class="token operator">.</span>zones
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>#添加：
zone &quot;ljq.com&quot; IN {    #域名根据自己的需求变化
		type master;
		file &quot;ljq.com.zone&quot;;
		allow-update { none; };
};
zone &quot;221.168.192.in-addr.arpa&quot; IN {     #ip根据自己的需求变化
		type master;
		file &quot;221.168.192.rev&quot;;
		allow-update { none; };
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /var/name
<span class="token function">cp</span> <span class="token parameter variable">-p</span> named.localhost ljq.com.zone
<span class="token function">cp</span> <span class="token parameter variable">-p</span> named.loopback <span class="token number">221.168</span>.192.rev
<span class="token function">vi</span> ljq.com.zone
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>#修改：
		$TTL 1D
		@       IN SOA  @ root.ljq.com. (
		                                        0       ; serial
		                                        1D      ; refresh
		                                        1H      ; retry
		                                        1W      ; expire
		                                        3H )    ; minimum
		              NS      dns.ljq.com.
		www     A       192.168.221.7
		ftp         A       192.168.221.7
		dns        A       192.168.221.7
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>vim 221.168.192.rev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>#修改：
		$TTL 1D
		@       IN SOA  @ root.ljq.com. (
		                                        0       ; serial
		                                        1D      ; refresh
		                                        1H      ; retry
		                                        1W      ; expire
		                                        3H )    ; minimum
		        NS      dns.ljq.com.
		7       PTR     www.ljq.com
		7       PTR     ftp.ljq.com
		7       PTR     dns.ljq.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_1-3-启动服务"><a href="#_1-3-启动服务" class="header-anchor">#</a> 1.3 启动服务</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>systemctl start named.service            //启动dns服务
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>systemctl <span class="token builtin class-name">enable</span> named.service          //开机自动启动dns服务
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="第二章-扩展"><a href="#第二章-扩展" class="header-anchor">#</a> 第二章 扩展</h2> <h3 id="_2-1-查看是否已经安装dns包"><a href="#_2-1-查看是否已经安装dns包" class="header-anchor">#</a> 2.1 查看是否已经安装DNS包</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">rpm</span> <span class="token parameter variable">-qa</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token builtin class-name">bind</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>bind-9.7.0-5.P2.el6.i686.rpm        //默认没有安装</p> <p>bind-libs-9.7.0-5.P2.el6.i686       //默认已安装bind-libs包</p> <p>bind-utils-9.7.0-5.P2.el6.i686      //默认已安装bind-utils包，有nslookup命令</p> <p>bind-chroot-9.7.0-5.P2.el6.i686.rpm //默认没有安装</p> <h3 id="_2-2-安装-基于本地安装"><a href="#_2-2-安装-基于本地安装" class="header-anchor">#</a> 2.2 安装(基于本地安装)</h3> <h4 id="_2-2-1-挂载光驱"><a href="#_2-2-1-挂载光驱" class="header-anchor">#</a> 2.2.1 挂载光驱</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">mount</span> /dev/cdrom /media
<span class="token builtin class-name">cd</span> /media/Packages
<span class="token function">ls</span> bind*
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_2-2-2-安装dns包"><a href="#_2-2-2-安装dns包" class="header-anchor">#</a> 2.2.2 安装DNS包</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> bind-9.7.0-5.P2.el6.i686.rpm
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> bind-chroot-9.7.0-5.P2.el6.i686.rpm
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_2-2-3-启动服务"><a href="#_2-2-3-启动服务" class="header-anchor">#</a> 2.2.3 启动服务</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">service</span> named start
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_2-2-4-关闭防火墙"><a href="#_2-2-4-关闭防火墙" class="header-anchor">#</a> 2.2.4 关闭防火墙</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">service</span> iptables stop          //临时关闭防火墙
<span class="token function">chkconfig</span> iptables off         //设置开机关闭防火墙
<span class="token function">chkconfig</span> <span class="token parameter variable">--list</span> <span class="token operator">|</span> <span class="token function">grep</span> iptables  //检查开机状态
<span class="token comment">#iptables       	0:关闭	1:关闭	2:关闭	3:关闭	4:关闭	5:关闭	6:关闭</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_2-2-5-关闭selinux"><a href="#_2-2-5-关闭selinux" class="header-anchor">#</a> 2.2.5 关闭SELinux</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>setenforce <span class="token number">0</span>                   <span class="token comment">#设置SELinux为Permissive</span>
getenforce                     <span class="token comment">#查看状态</span>
	<span class="token comment">#Permissive                       #宽容模式</span>
<span class="token function">vim</span> /etc/selinux/config        <span class="token comment">#设置开机SELinux为Permissive</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>#更改配置为如下参数
SELINUX=Permissive
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_2-2-6-开机自动启动"><a href="#_2-2-6-开机自动启动" class="header-anchor">#</a> 2.2.6 开机自动启动</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">chkconfig</span> named on             //设置开机自动启动
<span class="token function">chkconfig</span> <span class="token parameter variable">--list</span> <span class="token operator">|</span> <span class="token function">grep</span> named  //查看运行状态
<span class="token comment">#named      	0:关闭	1:关闭	2:启用	3:启用	4:启用	5:启用	6:关闭</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_2-2-7-dns默认功能测试及众多配置文件的作用"><a href="#_2-2-7-dns默认功能测试及众多配置文件的作用" class="header-anchor">#</a> 2.2.7 DNS默认功能测试及众多配置文件的作用</h4> <h5 id="_2-2-7-1-默认可以对主机名localhost进行正向解析和反向解析"><a href="#_2-2-7-1-默认可以对主机名localhost进行正向解析和反向解析" class="header-anchor">#</a> 2.2.7.1 默认可以对主机名localhost进行正向解析和反向解析</h5> <p>在测试默认的功能之前，必须先将Linux系统中的DNS设置为本机的IP：192.168.112.128，即将本机作为Linux系统上网的DNS服务器</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>vim /etc/resolv.conf
nameserver 192.168.112.128
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>修改配置文件/etc/named.conf中关于DNS的安全访问控制</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>vim /etc/named.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>options {
  listen-on port 53 { 192.168.112.128; };    #127.0.0.1改为192.168.112.128
  listen-on-v6 port 53 { ::1; };
  directory       &quot;/var/named&quot;;
  dump-file       &quot;/var/named/data/cache_dump.db&quot;;
  statistics-file &quot;/var/named/data/named_stats.txt&quot;;
  memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;;
  allow-query     { any; };    //localhost改为any
  recursion yes;
  #dnssec-enable yes;                         //注释掉
  #dnssec-validation yes;                     //注释掉
  #dnssec-lookaside auto;                     //注释掉
  /* Path to ISC DLV key */
  bindkeys-file &quot;/etc/named.iscdlv.key&quot;;
};
logging {
  channel default_debug {
  file &quot;data/named.run&quot;;
  severity dynamic;
  };
};
zone &quot;.&quot; IN {
  type hint;
  file &quot;named.ca&quot;;
};                 #第35-38行不能删，因为它能解析整个互联网
include &quot;/etc/named.rfc1912.zones&quot;;                //主配置文件/etc/named.rfc1912.zones，用于增加主机名和域名的正向解析和反向解析配置
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>①第11行127.0.0.1改为192.168.112.128</p> <p>②第17行localhost改为any</p> <p>③第20-22行注释掉：//注释掉3行</p> <p>重新启动DNS服务器</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">service</span> named restart
<span class="token function">cat</span> /etc/resolv.conf
<span class="token comment">#nameserver 192.168.112.128</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="_2-2-7-2-默认可以对主机名localhost进行正向解析"><a href="#_2-2-7-2-默认可以对主机名localhost进行正向解析" class="header-anchor">#</a> 2.2.7.2 默认可以对主机名localhost进行正向解析</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">host</span> localhost  <span class="token comment">#正向解析</span>
localhost has address <span class="token number">127.0</span>.0.1
localhost has IPv6 address ::1
<span class="token comment">#正向解析成功！</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>E：去掉localhost has IPv6 address ::1提示的方法</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> /var/named/named.localhost
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>$TTL 1D
@       IN SOA  @ rname.invalid. (
                                         0       ; serial
                                         1D      ; refresh
                                         1H      ; retry
                                         1W      ; expire
                                        3H )    ; minimum
         NS      @
         A       127.0.0.1
         AAAA    ::1                //删掉第10行
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>验证：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>service named restart
host localhost
localhost has address 127.0.0.1
正向解析成功！
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="_2-2-7-3-默认可以对主机名localhost进行反向解析"><a href="#_2-2-7-3-默认可以对主机名localhost进行反向解析" class="header-anchor">#</a> 2.2.7.3 默认可以对主机名localhost进行反向解析</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> /var/named/named.loopback
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>$TTL 1D
@       IN SOA  @ rname.invalid. (
                                         0       ; serial
                                         1D      ; refresh
                                         1H      ; retry
                                         1W      ; expire
                                         3H )    ; minimum
         NS      @
         A       127.0.0.1
         AAAA    ::1                //删掉第10行
         PTR     localhost.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>host 127.0.0.1  //反向解析
1.0.0.127.in-addr.arpa domain name pointer localhost.
反向解析成功！
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="_2-2-7-4-默认可以解析整个互联网"><a href="#_2-2-7-4-默认可以解析整个互联网" class="header-anchor">#</a> 2.2.7.4 默认可以解析整个互联网</h5> <p>做此测试操作的前提是，Linux本身能够正常上网（即能够正常打开网页）。</p> <p>只是将原来的DNS设置成我们自己的DNS服务器，以此来测试我们自己的DNS服务器的功能。</p> <p>先用Linux中的命令host来进行测试，如下所示：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>host www.baidu.com
host www.sohu.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>再将Windows作为客户端，在图形界面下测试DNS是否能够解析整个互联网（即是否能够通过自己的DNS服务器来打开网页）。</p> <p>前提条件是要保证Windows与Linux能够Ping通。（在虚拟机里准备或安装一个Win7 NAT方式来进行测试）</p> <h5 id="_2-2-7-5-dns服务器各个配置文件的作用"><a href="#_2-2-7-5-dns服务器各个配置文件的作用" class="header-anchor">#</a> 2.2.7.5 DNS服务器各个配置文件的作用</h5> <p>以主机名wgxy和域名test.com为例</p> <h6 id="_2-2-7-5-1-etc-resolv-conf"><a href="#_2-2-7-5-1-etc-resolv-conf" class="header-anchor">#</a> 2.2.7.5.1/etc/resolv.conf</h6> <p>设置域名服务器：修改nameserver 192.168.112.128</p> <h6 id="_2-2-7-5-2-etc-named-conf"><a href="#_2-2-7-5-2-etc-named-conf" class="header-anchor">#</a> 2.2.7.5.2 /etc/named.conf</h6> <p>主配置文件，安全访问控制：修改192.168.112.128，any，//注释掉3行</p> <h6 id="_2-2-7-5-3-etc-named-rfc1912-zones"><a href="#_2-2-7-5-3-etc-named-rfc1912-zones" class="header-anchor">#</a> 2.2.7.5.3 /etc/named.rfc1912.zones</h6> <p>主配置文件，需要增加主机名wgxy和域名test.com的正向解析和反向解析配置</p> <h6 id="_2-2-7-5-4-var-named-named-ca"><a href="#_2-2-7-5-4-var-named-named-ca" class="header-anchor">#</a> 2.2.7.5.4 /var/named/named.ca</h6> <p>根域配置文件，不能删，不用修改，因为它能解析整个互联网！</p> <div class="language- extra-class"><pre><code>; &lt;&lt;&gt;&gt; DiG 9.5.0b2 &lt;&lt;&gt;&gt; +bufsize=1200 +norec NS . @a.root-servers.net

;; global options:  printcmd

;; Got answer:

;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 34420

;; flags: qr aa; QUERY: 1, ANSWER: 13, AUTHORITY: 0, ADDITIONAL: 20
 ;; OPT PSEUDOSECTION:
 ; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
 ;.                              IN      NS
;; ANSWER SECTION:
 .                       518400  IN      NS      M.ROOT-SERVERS.NET.
.                       518400  IN      NS      A.ROOT-SERVERS.NET.
 .                       518400  IN      NS      B.ROOT-SERVERS.NET.
 .                       518400  IN      NS      C.ROOT-SERVERS.NET.
 .                       518400  IN      NS      D.ROOT-SERVERS.NET.
 .                       518400  IN      NS      E.ROOT-SERVERS.NET.
.                       518400  IN      NS      F.ROOT-SERVERS.NET.
 .                       518400  IN      NS      G.ROOT-SERVERS.NET.
 .                       518400  IN      NS      H.ROOT-SERVERS.NET.
 .                       518400  IN      NS      I.ROOT-SERVERS.NET.
 .                       518400  IN      NS      J.ROOT-SERVERS.NET.
 .                       518400  IN      NS      K.ROOT-SERVERS.NET.
 .                       518400  IN      NS      L.ROOT-SERVERS.NET.
;; ADDITIONAL SECTION:
 A.ROOT-SERVERS.NET.     3600000 IN      A       198.41.0.4
 A.ROOT-SERVERS.NET.     3600000 IN      AAAA    2001:503:ba3e::2:30
 B.ROOT-SERVERS.NET.     3600000 IN      A       192.228.79.201
 C.ROOT-SERVERS.NET.     3600000 IN      A       192.33.4.12
 D.ROOT-SERVERS.NET.     3600000 IN      A       128.8.10.90
 E.ROOT-SERVERS.NET.     3600000 IN      A       192.203.230.10
 F.ROOT-SERVERS.NET.     3600000 IN      A       192.5.5.241
 F.ROOT-SERVERS.NET.     3600000 IN      AAAA    2001:500:2f::f
 G.ROOT-SERVERS.NET.     3600000 IN      A       192.112.36.4
H.ROOT-SERVERS.NET.     3600000 IN      A       128.63.2.53
 H.ROOT-SERVERS.NET.     3600000 IN      AAAA    2001:500:1::803f:235
 I.ROOT-SERVERS.NET.     3600000 IN      A       192.36.148.17
 J.ROOT-SERVERS.NET.     3600000 IN      A       192.58.128.30
 J.ROOT-SERVERS.NET.     3600000 IN      AAAA    2001:503:c27::2:30
 K.ROOT-SERVERS.NET.     3600000 IN      A       193.0.14.129
 K.ROOT-SERVERS.NET.     3600000 IN      AAAA    2001:7fd::1
 L.ROOT-SERVERS.NET.     3600000 IN      A       199.7.83.42
 M.ROOT-SERVERS.NET.     3600000 IN      A       202.12.27.33
 M.ROOT-SERVERS.NET.     3600000 IN      AAAA    2001:dc3::35
;; Query time: 147 msec
;; SERVER: 198.41.0.4#53(198.41.0.4)
;; WHEN: Mon Feb 18 13:29:18 2008
 ;; MSG SIZE  rcvd: 615
</code></pre></div><p>A-M，13台根域名服务器</p> <p>根服务器，主要用来管理互联网的主目录，全世界IPv4根服务器只有13台（这13台IPv4根域名服务器名字分别为“A”至“M”），1个为主根服务器在美国。其余12个均为辅根服务器，其中9个在美国，欧洲2个（英国和瑞典），亚洲1个（日本）。</p> <h6 id="_2-2-7-5-5-var-named-named-localhost"><a href="#_2-2-7-5-5-var-named-named-localhost" class="header-anchor">#</a> 2.2.7.5.5 /var/named/named.localhost</h6> <p>本机默认主机名localhost的正向解析文件：localhost→127.0.0.1</p> <p>named.localhost和named.loopback文件起着“模板文件”的作用。</p> <p>在实际配置DNS的过程中，一般都是将这两个文件改名复制成自定义域名的正向解析文件和反向解析文件，然后再在其基础上进行相应的修改。</p> <h6 id="_2-2-7-5-6-var-named-named-loopback"><a href="#_2-2-7-5-6-var-named-named-loopback" class="header-anchor">#</a> 2.2.7.5.6 /var/named/named.loopback</h6> <p>本机默认主机名localhost的反向解析文件：127.0.0.1→localhost</p> <p>named.localhost和named.loopback文件起着“模板文件”的作用。</p> <p>在实际配置DNS的过程中，一般都是将这两个文件改名复制成自定义域名的正向解析文件和反向解析文件，然后再在其基础上进行相应的修改。</p> <h6 id="_2-2-7-5-7-var-named-wgxy-zone"><a href="#_2-2-7-5-7-var-named-wgxy-zone" class="header-anchor">#</a> 2.2.7.5.7 /var/named/wgxy.zone</h6> <p>主机名wgxy的正向解析文件</p> <p>wgxy→192.168.112.128</p> <p>来自named.localhost模板，将第9行A  127.0.0.1改为A  192.168.112.128</p> <h6 id="_2-2-7-5-8-var-named-test-com-zone"><a href="#_2-2-7-5-8-var-named-test-com-zone" class="header-anchor">#</a> 2.2.7.5.8 /var/named/test.com.zone</h6> <p>某域名test.com的正向解析文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dns.test.com→192.168.112.128  //DNS服务器
www.test.com→192.168.112.128  //Web服务器
ftp.test.com→192.168.112.128  //FTP服务器
mail.test.com→192.168.112.129  //Mail服务器
#在/etc/named.rfc1912.zones中定义
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h6 id="_2-2-7-5-9-var-named-192-168-112-arpa"><a href="#_2-2-7-5-9-var-named-192-168-112-arpa" class="header-anchor">#</a> 2.2.7.5.9 /var/named/192.168.112.arpa</h6> <p>某域名test.com的反向解析文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>192.168.112.128→dns.test.com
192.168.112.128→www.test.com
192.168.112.128→ftp.test.com
192.168.112.129→mail.test.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在/etc/named.rfc1912.zones中定义</p> <h5 id="_2-2-8-配置本机主机名wgxy的正向解析及测试"><a href="#_2-2-8-配置本机主机名wgxy的正向解析及测试" class="header-anchor">#</a> 2.2.8 配置本机主机名wgxy的正向解析及测试</h5> <p>正向解析：wgxy→192.168.112.128</p> <p>(1)首先，在/etc/named.rfc1912.zones文件中定义该主机名的一个正向域</p> <p>vim /etc/named.rfc1912.zones</p> <div class="language- extra-class"><pre><code>zone &quot;localhost&quot; IN {
         type master;
         file &quot;named.localhost&quot;;
         allow-update { none; };
 }; 
</code></pre></div><p>复制以上19-24行共6行，并改为：</p> <div class="language- extra-class"><pre><code>zone &quot;wgxy&quot; IN {           //定义该主机名的一个域zone
         type master;
         file &quot;wgxy.zone&quot;;  //指定该主机名的正向解析文件。记住该文件名，一会儿要在/var/named目录中去创建它
         allow-update { none; };
 }; 
</code></pre></div><p>(2)然后，进入/var/named目录，复制named.localhost并改名为wgxy.zone</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cd /var/named
cp -p named.localhost wgxy.zone
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>vim wgxy.zone</p> <div class="language- extra-class"><pre><code>$TTL 1D
@       IN SOA  @ rname.invalid. (
                                         0       ; serial   //版本号
                                         1D      ; refresh  //每隔1天刷新纪录
                                         1H      ; retry    //每隔1小时重发请求
                                         1W      ; expire   //1周无法连接上主域名服务器，DNS记录失效
                                         3H )    ; minimum  //DNS记录TTL的最小值为3小时
         NS      @
         A       192.168.112.128                            //将该行的IP“127.0.0.1”，改为“192.168.112.128”即可！
</code></pre></div><p>(3)重启DNS服务器，并进行主机名“wgxy”的正向解析测试</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>service named restart
host wgxy
wgxy has address 192.168.112.128
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>能正向解析出主机名“wgxy”对应的IP地址，配置成功！</p> <p>注：若显示：Host wgxy not found: 3(NXDOMAIN)，再次修改# vim /etc/resolv.conf中的nameserver 192.168.112.128</p> <h5 id="_2-2-9-配置本机主机名wgxy的反向解析及测试"><a href="#_2-2-9-配置本机主机名wgxy的反向解析及测试" class="header-anchor">#</a> 2.2.9 配置本机主机名wgxy的反向解析及测试</h5> <p>反向解析：192.168.112.128→wgxy</p> <p>(1)首先，在/etc/named.rfc1912.zones文件中定义该主机名的一个反向域：</p> <p>vim /etc/named.rfc1912.zones</p> <div class="language- extra-class"><pre><code>zone &quot;1.0.0.127.in-addr.arpa&quot; IN {
        type master;
        file &quot;named.loopback&quot;;
        allow-update { none; };
}; 
</code></pre></div><p>复制以上37-42行共6行，并改为：</p> <div class="language- extra-class"><pre><code>zone &quot;112.168.192.in-addr.arpa&quot; IN {   //注意：反向解析的最大的一个特点就是将IP地址“192.168.112.128”反着写
        type master;
         file &quot;192.168.112.arpa&quot;;       //指定该主机名的反向解析文件。记住该文件名，一会儿要在/var/named目录中去创建它
         allow-update { none; };
};
</code></pre></div><p>(2)然后，进入/var/named目录，复制named.loopback并改名为192.168.112.arpa</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cd /var/named
cp -p named.loopback 192.168.112.arpa
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>vim 192.168.112.arpa</p> <div class="language- extra-class"><pre><code>$TTL 1D
@       IN SOA  @ rname.invalid. (
                                        0       ; serial
                                         1D      ; refresh
                                        1H      ; retry
                                        1W      ; expire
                                        3H )    ; minimum
        NS      @
         A       192.168.112.128 //将该行的IP“127.0.0.1”，改为“192.168.112.128”
         AAAA    ::1             //删除该行IPv6的地址
 128     PTR     wgxy.           //128，即192.168.112.128；PTR即指向后面的“wgxy.”，注意后面的那个点“.”不能掉，否则配置不成功！
</code></pre></div><p>(3)重启DNS服务器，并进行主机名“wgxy”的反向解析测试</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>service named restart
host 192.168.112.128
128.112.168.192.in-addr.arpa domain name pointer wgxy.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>能反向解析出IP地址“192.168.112.128”对应的主机名，配置成功！</p> <h5 id="_2-2-10-配置域名-test-com-的正向解析及测试"><a href="#_2-2-10-配置域名-test-com-的正向解析及测试" class="header-anchor">#</a> 2.2.10 配置域名“test.com”的正向解析及测试</h5> <p>(1)首先，在/etc/named.rfc1912.zones文件中定义“test.com”的正向域</p> <p>vim /etc/named.rfc1912.zones</p> <div class="language- extra-class"><pre><code>zone &quot;wgxy&quot; IN {
        type master;
        file &quot;wgxy.zone&quot;;
        allow-update { none; };
};
</code></pre></div><p>复制以上25-30行共6行，并改为：</p> <div class="language- extra-class"><pre><code>zone &quot;test.com&quot; IN {          //定义“test.com”这个域
         type master;
        file &quot;test.com.zone&quot;; //指定该主机名的正向解析文件。记住该文件名，一会儿要在/var/named目录中去创建它
         allow-update { none; };
};
</code></pre></div><p>(2)然后，进入/var/named目录，复制named.localhost并改名为test.com.zone</p> <div class="language- extra-class"><pre><code>cd /var/named
cp -p named.localhost test.com.zone
vim test.com.zone
</code></pre></div><div class="language- line-numbers-mode"><pre class="language-text"><code>$TTL 1D
@       IN SOA  @ rname.invalid. (
                                         0       ; serial
                                        1D      ; refresh
                                        1H      ; retry
                                         1W      ; expire
                                        3H )    ; minimum
         NS      dns.test.com.      //“test.com”这个域的DNS服务器，必须有。注意这个点“.”
        MX 5    mail.test.com.     //该域的邮件服务器。注意这个点“.”
dns    A    192.168.112.128    //DNS服务器对应的IP地址
www    A    192.168.112.128    //网页服务器对应的IP地址
ftp    CNAME    www                //FTP服务器是www的别名，即与www服务器使用相同的IP地址
mail    A    192.168.112.129    //邮件服务器对应的IP地址
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>(3)重启DNS服务器，并对各种服务器进行正向解析测试</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>service named restart
vim /etc/resolv.conf
host dns.test.com
dns.test.com has address 192.168.112.128
host www.test.com
www.test.com has address 192.168.112.128
host ftp.test.com
ftp.test.com is an alias for www.test.com.
www.test.com has address 192.168.112.128
host mail.test.com
mail.test.com has address 192.168.112.129
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>能正向解析出各个域名所对应的IP地址，配置成功！</p> <p>(4)架设一个Web服务器，并用vi编辑器制作一个简单的网页（已经Xftp上传网站到/var/www/html/TestWeb2/），</p> <p>然后在虚拟机Win7（IP：192.168.112.129）里通过域名www.test.com访问该网页。</p> <p>1)在Linux里安装Web服务器，并启动它(自动安装，前述已设置开机自动启动)；</p> <p>2)在其网页目录中(/etc/www/html/TestWeb2)制作一个简单网页index.html（已经xftp上传网站到/var/www/html/TestWeb2/）；</p> <p>3)更改Windows里的DNS设置，使其指向Linux中的DNS服务器192.168.112.128；</p> <p>4)打开Windows中的浏览器，输入域名http://www.test.com/TestWeb2/进行浏览测试。</p> <p>访问外网也应该能成功？nameserver 8.8.8.8？</p> <p>Web服务器、DNS服务器合并操作，配置成功！</p> <h5 id="_2-2-11-配置域名-test-com-的反向解析及测试"><a href="#_2-2-11-配置域名-test-com-的反向解析及测试" class="header-anchor">#</a> 2.2.11 配置域名“test.com”的反向解析及测试</h5> <p>192.168.112.128  dns.test.com</p> <div class="language- extra-class"><pre><code>             www.test.com

             ftp.test.com
</code></pre></div><p>192.168.112.129  mail.test.com</p> <p>由于在前面配置本机主机名的反向解析时，</p> <p>在/etc/named.rfc1912.zones文件建立过“192.168.112.0/24”这个IP段的反向域及其反向解析文件，</p> <p>故在此删除或改用该IP段的反向域及其反向解析文件。</p> <p>(1)首先，在/etc/named.rfc1912.zones文件中定义“test.com”的反向域</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>vim /etc/named.rfc1912.zones
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>(2)然后，进入/var/named目录，复制named.loopback并改名为192.168.112.arpa（前面主机名的反向解析已复制、改名）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> /var/named/192.168.112.arpa
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>$TTL 1D
@	IN SOA	@ rname.invalid. (
						0	; serial
						1D	; refresh
						1H	; retry
					1W	; expire
					3H )	; minimum
		  NS    dns.test.com.
128    PTR    dns.test.com.
128    PTR    www.test.com.
128    PTR    ftp.test.com.
129    PTR    mail.test.com.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>各个服务器对应IP的最后一个数字，如128，通过PTR指向其对应的域名。</p> <p>注意：后面的那个点不能掉，否则配置不成功！</p> <p>(3)重启DNS服务器，并对以下各个域名进行反向解析测试</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>service named restart

vim /etc/resolv.conf

host 192.168.112.128

128.112.168.192.in-addr.arpa domain name pointer dns.test.com.

128.112.168.192.in-addr.arpa domain name pointer ftp.test.com.

128.112.168.192.in-addr.arpa domain name pointer www.test.com.

host 192.168.112.129

129.112.168.192.in-addr.arpa domain name pointer mail.test.com.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>反向解析成功！</p> <h2 id="第三章-总结"><a href="#第三章-总结" class="header-anchor">#</a> 第三章 总结</h2> <p>DNS服务器9个配置文件及作用：</p> <p>以配置<wgxy>.test.com的dns、www、ftp、mail为例：</wgxy></p> <p>主机名wgxy，IP地址192.168.112.128，域名test.com，服务dns、www、ftp、mail</p> <p>目录：/etc/，3个文件</p> <p>-rw-r--r--. 1 root root   123  3月 11 12:20 resolv.conf</p> <p>-rw-r-----. 1 root named  936  3月 11 12:27 named.conf</p> <p>-rw-r-----. 1 root named 1203  3月 11 12:44 named.rfc1912.zones</p> <p>目录：/var/named/，6个文件</p> <p>-rw-r-----. 1 root  named 1892  2月 18 2008  named.ca</p> <p>-rw-r-----. 1 root  named  142  3月 11 12:28 named.localhost</p> <p>-rw-r-----. 1 root  named  158  3月 11 12:29 named.loopback</p> <p>-rw-r-----. 1 root  named  148  3月 11 12:35 wgxy.zone</p> <p>-rw-r-----. 1 root  named  244  3月 11 12:53 test.com.zone</p> <p>-rw-r-----. 1 root  named  230  3月 11 12:58 192.168.112.arpa</p> <p>9个文件分布在两个目录</p> <p>resolv.conf         //设置域名服务器：修改nameserver 192.168.112.128</p> <p>named.conf          //主配置文件，安全访问控制：修改192.168.112.128，any，//注释掉3行</p> <p>●named.rfc1912.zones //主配置文件，增加主机名wgxy和域名test.com的正向解析和反向解析配置</p> <div class="language- extra-class"><pre><code>            正向解析                                |反向解析

zone &quot;wgxy&quot; IN {			|
    type master;			|

    file &quot;wgxy.zone&quot;;	        |

        allow-update { none; };	|

 };//主机名wgxy的正向解析，见③	|

                                                |

zone &quot;test.com&quot; IN {			|49 zone &quot;112.168.192.in-addr.arpa&quot; IN {

        type master;			|50         type master;

         file &quot;test.com.zone&quot;;	|51         file &quot;192.168.112.arpa&quot;;	

         allow-update { none; };	|52         allow-update { none; };

};//域名test.com的正向解析，见④	|53 };//域名test.com的反向解析，见⑤
</code></pre></div><p>named.ca            //根域配置文件，不能删，不用修改，因为它能解析整个互联网！</p> <p>①named.localhost     //默认主机名localhost的正向解析文件：删掉第10行(不要IPv6地址)：AAAA  ::1</p> <p>②named.loopback      //默认主机名localhost的反向解析文件：删掉第10行(不要IPv6地址)：AAAA  ::1</p> <p>③wgxy.zone           //主机名wgxy的正向解析文件：来自named.localhost模板，将第9行A  127.0.0.1改为A  192.168.112.128</p> <p>④test.com.zone       //域名test.com的正向解析文件：来自named.localhost模板，将</p> <div class="language- extra-class"><pre><code>NS	@
A	127.0.0.1
</code></pre></div><p>改为：</p> <div class="language- extra-class"><pre><code>		NS    dns.test.com.

		MX 5    mail.test.com.

 dns    A    192.168.112.128

 www    A	    192.168.112.128

 ftp    CNAME    www

 mail    A    192.168.112.129
</code></pre></div><p>⑤192.168.112.arpa    //域名test.com的反向解析文件：来自named.loopback模板，将</p> <div class="language- extra-class"><pre><code>		NS	@

		A	127.0.0.1

	PTR	localhost.
</code></pre></div><p>改为：</p> <div class="language- extra-class"><pre><code>		NS	dns.test.com.
	128	PTR	dns.test.com.
 128	PTR	www.test.com.
 128	PTR	ftp.test.com.
 129	PTR	mail.test.com.
</code></pre></div></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2022/12/30 00:15:20</span></div></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-6986a797 data-v-6f8f7dda><li class="level-2" data-v-6986a797><a href="/docs/Linux%E8%BF%90%E7%BB%B4/%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1.html#第一章-配置单个dns" class="sidebar-link reco-side-第一章-配置单个dns" data-v-6986a797>第一章 配置单个DNS</a></li><li class="level-3" data-v-6986a797><a href="/docs/Linux%E8%BF%90%E7%BB%B4/%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1.html#_1-1-安装dns" class="sidebar-link reco-side-_1-1-安装dns" data-v-6986a797>1.1 安装DNS</a></li><li class="level-3" data-v-6986a797><a href="/docs/Linux%E8%BF%90%E7%BB%B4/%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1.html#_1-2-配置dns文件" class="sidebar-link reco-side-_1-2-配置dns文件" data-v-6986a797>1.2 配置DNS文件</a></li><li class="level-3" data-v-6986a797><a href="/docs/Linux%E8%BF%90%E7%BB%B4/%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1.html#_1-3-启动服务" class="sidebar-link reco-side-_1-3-启动服务" data-v-6986a797>1.3 启动服务</a></li><li class="level-2" data-v-6986a797><a href="/docs/Linux%E8%BF%90%E7%BB%B4/%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1.html#第二章-扩展" class="sidebar-link reco-side-第二章-扩展" data-v-6986a797>第二章 扩展</a></li><li class="level-3" data-v-6986a797><a href="/docs/Linux%E8%BF%90%E7%BB%B4/%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1.html#_2-1-查看是否已经安装dns包" class="sidebar-link reco-side-_2-1-查看是否已经安装dns包" data-v-6986a797>2.1 查看是否已经安装DNS包</a></li><li class="level-3" data-v-6986a797><a href="/docs/Linux%E8%BF%90%E7%BB%B4/%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1.html#_2-2-安装-基于本地安装" class="sidebar-link reco-side-_2-2-安装-基于本地安装" data-v-6986a797>2.2 安装(基于本地安装)</a></li><li class="level-2" data-v-6986a797><a href="/docs/Linux%E8%BF%90%E7%BB%B4/%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1.html#第三章-总结" class="sidebar-link reco-side-第三章-总结" data-v-6986a797>第三章 总结</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><!----><canvas id="vuepress-canvas-cursor"></canvas><div class="reco-bgm-panel" data-v-b1d3339e><audio id="bgm" src="https://file.cndis.cn/music/%E6%B6%88%E6%84%81.mp3" data-v-b1d3339e></audio> <div class="reco-float-box" style="bottom:100px;z-index:101;display:none;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><img src="http://p1.music.126.net/vmCcDvD1H04e9gm97xsCqg==/109951163350929740.jpg?param=130y130" data-v-b1d3339e></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="reco-bgm-cover" style="background-image:url(http://p1.music.126.net/vmCcDvD1H04e9gm97xsCqg==/109951163350929740.jpg?param=130y130);" data-v-b1d3339e><div class="mini-operation" style="display:none;" data-v-b1d3339e><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-b1d3339e></i></div> <div class="falut-message" style="display:none;" data-v-b1d3339e>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-music music" data-v-b1d3339e></i>消愁</div> <div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-artist" data-v-b1d3339e></i>毛不易</div> <div class="reco-bgm-progress" data-v-b1d3339e><div class="progress-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div> <div class="reco-bgm-operation" data-v-b1d3339e><i class="reco-bgm reco-bgm-last last" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play play" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-next next" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-b1d3339e></i> <div class="volume-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div></div> <div class="reco-bgm-left-box" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><i class="reco-bgm reco-bgm-left" data-v-b1d3339e></i></div></div></div></div></div>
    <script src="/assets/js/app.4cb69ec2.js" defer></script><script src="/assets/js/4.1668cfe5.js" defer></script><script src="/assets/js/1.9ad7271c.js" defer></script><script src="/assets/js/41.2921d41f.js" defer></script>
  </body>
</html>
